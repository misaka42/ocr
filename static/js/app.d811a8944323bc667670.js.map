{"version":3,"sources":["webpack:///static/js/app.d811a8944323bc667670.js","webpack:///./src/Canvas.js","webpack:///./src/main.js","webpack:///home.vue","webpack:///./src/lib.js","webpack:///./src/home.vue?7482","webpack:///./src/home.vue"],"names":["webpackJsonp","11","module","__webpack_exports__","__webpack_require__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default","n","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default","lib","config","Element","cvs","size","arguments","length","undefined","canvas","this","document","createElement","callback","init","key","value","setSize","addEvent","drawStart","drawEnd","drawing","arr","fn","_this","forEach","name","addEventListener","e","call","preventDefault","_line","clearTimeout","_afterDraw","touches","offsetX","pageX","offsetY","pageY","add","stashPop","Line","setTimeout","afterDraw","bind","stash","area","getAdjustDetectArea","data","getGridData","finish","drawAreaBorder","style","_snapshot","getContext","getImageData","width","height","putImageData","clearCanvas","getDetectArea","getAdjustArea","ctx","ratio","window","devicePixelRatio","x","y","_last","drawLine","drawArc","p","beginPath","moveTo","lineTo","lineWidth","pen","strokeStyle","fillStyle","stroke","arc","Math","PI","fill","12","Object","defineProperty","__WEBPACK_IMPORTED_MODULE_0_vue__","__WEBPACK_IMPORTED_MODULE_1__home__","__WEBPACK_IMPORTED_MODULE_1__home___default","__WEBPACK_IMPORTED_MODULE_2_normalize_css__","__WEBPACK_IMPORTED_MODULE_3__index_less__","productionTip","el","template","components","home","a","13","__WEBPACK_IMPORTED_MODULE_0__Canvas__","__WEBPACK_IMPORTED_MODULE_1__lib__","__WEBPACK_IMPORTED_MODULE_1__lib___default","STATE_MSG","0","1","2","state","fontLib","imgSrc","computed","msg","created","initFontLib","mounted","$nextTick","methods","_this2","_canvas","$refs","_match","match","grid","matched","findMatch","img","drawArea","compare","b","abs","reset","clear","confirm","exports","innerWidth","like","accept","grayThreshold","convertImageData","i","push","compareArray","v","validPoint","filter","parseFloat","toFixed","combineArray","clearRect","addFont","str","font","textAlign","fillText","toDataURL","fixFont","fontLibItem","gridData","drawGridData","rect","X","Y","_ref","step","index","console","log","fillRect","_ref2","strokeRect","imageData","floor","XStart","XEnd","YStart","YEnd","XOffset","YOffset","adjustArea","offset","half","px","xx","yy","percent","String","fromCharCode","acc","sort","29","render","_vm","_h","$createElement","_c","_self","attrs","id","ref","_v","_s","directives","rawName","expression","src","alt","on","click","staticRenderFns","7","8","9","Component"],"mappings":"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","file":"static/js/app.d811a8944323bc667670.js","sourcesContent":["webpackJsonp([1],{\n\n/***/ 11:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__ = __webpack_require__(15);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__ = __webpack_require__(16);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__);\n\n\nvar lib = __webpack_require__(2);\nvar config = lib.config;\n\nvar Element = function () {\n  function Element(cvs) {\n    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : config.canvas.size;\n\n    __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default()(this, Element);\n\n    if (cvs === undefined) {\n      cvs = document.createElement('canvas');\n    }\n    this.cvs = cvs;\n    this.size = size;\n    this.callback = {};\n    this.init(cvs);\n  }\n\n  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default()(Element, [{\n    key: 'init',\n    value: function init(cvs) {\n      lib.setSize(cvs, this.size);\n      this.addEvent(['mousedown', 'touchstart'], this.drawStart);\n      this.addEvent(['mouseup', 'mouseleave', 'mouseenter', 'touchend'], this.drawEnd);\n      this.addEvent(['mousemove', 'touchmove'], this.drawing);\n    }\n  }, {\n    key: 'addEvent',\n    value: function addEvent(arr, fn) {\n      var _this = this;\n\n      arr.forEach(function (name) {\n        _this.cvs.addEventListener(name, function (e) {\n          fn.call(_this, e);\n          e.preventDefault();\n        });\n      });\n    }\n  }, {\n    key: 'drawing',\n    value: function drawing(e) {\n      if (!this._line) {\n        return;\n      }\n      clearTimeout(this._afterDraw);\n      if (e.touches && e.touches[0]) {\n        e.offsetX = e.touches[0].pageX;\n        e.offsetY = e.touches[0].pageY;\n      }\n      this._line.add(e.offsetX, e.offsetY);\n    }\n  }, {\n    key: 'drawStart',\n    value: function drawStart() {\n      this.stashPop();\n      this._line = new Line(this.cvs);\n    }\n  }, {\n    key: 'drawEnd',\n    value: function drawEnd() {\n      this._line = null;\n      this._afterDraw = setTimeout(this.afterDraw.bind(this), 600);\n    }\n  }, {\n    key: 'afterDraw',\n    value: function afterDraw() {\n      this.stash();\n      var area = this.getAdjustDetectArea();\n      var data = lib.getGridData(this.cvs, area);\n      this.callback.finish(data);\n      lib.drawAreaBorder({\n        cvs: this.cvs,\n        area: area,\n        style: 'rgba(255, 0, 0, 0.5)'\n      });\n    }\n  }, {\n    key: 'stash',\n    value: function stash() {\n      this._snapshot = this.cvs.getContext('2d').getImageData(0, 0, this.cvs.width, this.cvs.height);\n    }\n  }, {\n    key: 'stashPop',\n    value: function stashPop() {\n      if (!this._snapshot) {\n        return;\n      }\n      this.cvs.getContext('2d').putImageData(this._snapshot, 0, 0);\n      this._snapshot = null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      this._snapshot = null;\n      lib.clearCanvas(this.cvs);\n    }\n  }, {\n    key: 'getDetectArea',\n    value: function getDetectArea() {\n      return lib.getDetectArea(this.cvs);\n    }\n  }, {\n    key: 'getAdjustDetectArea',\n    value: function getAdjustDetectArea() {\n      return lib.getAdjustArea(this.cvs);\n    }\n  }]);\n\n  return Element;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Element);\n\nvar Line = function () {\n  function Line(cvs) {\n    __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default()(this, Line);\n\n    this.cvs = cvs;\n    this.ctx = cvs.getContext('2d');\n    this.ratio = window.devicePixelRatio;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default()(Line, [{\n    key: 'add',\n    value: function add(x, y) {\n      x *= this.ratio;\n      y *= this.ratio;\n      if (this._last) {\n        this.drawLine(this._last, { x: x, y: y });\n      }\n      this.drawArc(x, y);\n      this._last = { x: x, y: y };\n    }\n  }, {\n    key: 'drawLine',\n    value: function drawLine(p, n) {\n      this.ctx.beginPath();\n      this.ctx.moveTo(p.x, p.y);\n      this.ctx.lineTo(n.x, n.y);\n      this.ctx.lineWidth = config.pen.size * 2;\n      this.ctx.strokeStyle = config.pen.fillStyle;\n      this.ctx.stroke();\n    }\n  }, {\n    key: 'drawArc',\n    value: function drawArc(x, y) {\n      this.ctx.beginPath();\n      this.ctx.arc(x, y, config.pen.size, 0, Math.PI * 2);\n      this.ctx.fillStyle = config.pen.fillStyle;\n      this.ctx.fill();\n    }\n  }]);\n\n  return Line;\n}();\n\n/***/ }),\n\n/***/ 12:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_vue__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__home__ = __webpack_require__(9);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__home___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__home__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_normalize_css__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_normalize_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_normalize_css__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__index_less__ = __webpack_require__(8);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__index_less___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3__index_less__);\n\n\n\n\n\n\n__WEBPACK_IMPORTED_MODULE_0_vue__[\"a\" /* default */].config.productionTip = false;\n\nnew __WEBPACK_IMPORTED_MODULE_0_vue__[\"a\" /* default */]({\n  el: '#app',\n  template: '<home/>',\n  components: { home: __WEBPACK_IMPORTED_MODULE_1__home___default.a }\n});\n\n/***/ }),\n\n/***/ 13:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Canvas__ = __webpack_require__(11);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__lib__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__lib___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__lib__);\n\n\n\n\n\nvar config = __WEBPACK_IMPORTED_MODULE_1__lib___default.a.config;\n\nvar STATE_MSG = {\n  0: '正在初始化数据...',\n  1: '在上方画布开始绘画',\n  2: '识别是否准确？'\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  data: function data() {\n    return {\n      state: 0,\n      fontLib: __WEBPACK_IMPORTED_MODULE_1__lib___default.a.fontLib,\n      imgSrc: ''\n    };\n  },\n\n  computed: {\n    msg: function msg() {\n      return STATE_MSG[this.state];\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    setTimeout(function () {\n      __WEBPACK_IMPORTED_MODULE_1__lib___default.a.initFontLib();\n      _this.state = 1;\n    }, 0);\n  },\n  mounted: function mounted() {\n    this.$nextTick(this.init);\n  },\n\n  methods: {\n    init: function init() {\n      var _this2 = this;\n\n      this._canvas = new __WEBPACK_IMPORTED_MODULE_0__Canvas__[\"a\" /* default */](this.$refs.cvs);\n      this._match = new __WEBPACK_IMPORTED_MODULE_0__Canvas__[\"a\" /* default */](this.$refs.match, config.grid * 4);\n\n      this._canvas.callback.finish = function (data) {\n        _this2.state = 2;\n        var matched = __WEBPACK_IMPORTED_MODULE_1__lib___default.a.findMatch(data);\n        __WEBPACK_IMPORTED_MODULE_1__lib___default.a.setSize(_this2.$refs.img, config.grid * 4);\n        _this2.imgSrc = matched.img;\n\n        __WEBPACK_IMPORTED_MODULE_1__lib___default.a.drawArea({\n          cvs: _this2.$refs.match,\n          data: data,\n          area: { x: 0, y: 0, size: _this2.$refs.match.width },\n          compare: matched.data,\n          style: function style(a, b) {\n            if (a === 0 && b > 0) {\n              return 'rgba(255, 0, 0, ' + b / 2 + ')';\n            }\n            if (b === 0 && a > 0) {\n              return 'rgba(0, 0, 0, ' + a + ')';\n            }\n            if (a === 0 && b === 0) {\n              return '#fff';\n            }\n            return 'rgba(0, 255, 0, ' + (1 - Math.abs(a - b)) + ')';\n          }\n        });\n      };\n    },\n    reset: function reset() {\n      this.state = 1;\n      this._canvas.clear();\n    },\n    confirm: function confirm() {\n      this.state = 1;\n      this._canvas.clear();\n    }\n  }\n});\n\n/***/ }),\n\n/***/ 2:\n/***/ (function(module, exports) {\n\nvar config = {\n  pen: {\n    size: 10,\n    fillStyle: '#000'\n  },\n  canvas: {\n    width: 200,\n    height: 200,\n    size: window.innerWidth > 400 ? 400 : window.innerWidth\n  },\n  grid: 32,\n  like: 0.1,\n  accept: 0.6,\n  grayThreshold: 128\n};\n\nvar fontLib = [];\n\nexports.config = config;\nexports.fontLib = fontLib;\n\nexports.convertImageData = function (data) {\n  var arr = [];\n  for (var i = 0; i < data.length; i += 4) {\n    if (data[i + 3] === 0) {\n      arr.push(0);\n      continue;\n    }\n    if (data[i] + data[i + 1] + data[i + 2] > config.grayThreshold * 3) {\n      arr.push(0);\n    } else {\n      arr.push(1);\n    }\n  }\n  return arr;\n};\n\nexports.compareArray = function (a, b) {\n  var matched = 0;\n  a.forEach(function (v, i) {\n    if (v === 0 && b[i] === 0) {\n      return;\n    }\n    if (Math.abs(v - b[i]) < config.like) {\n      matched++;\n    }\n  });\n  var validPoint = a.filter(function (v) {\n    return v > 0;\n  }).length + b.filter(function (v) {\n    return v > 0;\n  }).length;\n  return parseFloat(matched / validPoint).toFixed(4);\n};\n\nexports.combineArray = function (a, b) {\n  var arr = [];\n  a.forEach(function (v, i) {\n    arr.push((v + b[i]) / 2);\n  });\n  return arr;\n};\n\nexports.setSize = function (cvs, size) {\n  cvs.width = size * window.devicePixelRatio;\n  cvs.height = size * window.devicePixelRatio;\n  cvs.style.width = size + 'px';\n  cvs.style.height = size + 'px';\n};\n\nexports.clearCanvas = function (cvs) {\n  cvs.getContext('2d').clearRect(0, 0, cvs.width, cvs.height);\n};\n\nexports.addFont = function (str, font) {\n  if (this._canvas === undefined) {\n    this._canvas = document.createElement('canvas');\n  }\n  var cvs = this._canvas;\n  this.setSize(cvs, config.grid * 4);\n  var ctx = cvs.getContext('2d');\n\n  this.clearCanvas(cvs);\n  ctx.font = '200 ' + cvs.height / 2 + 'px ' + font;\n  ctx.textAlign = 'center';\n  ctx.fillStyle = '#000';\n  ctx.fillText(str, cvs.width / 2, cvs.height / 2);\n\n  var area = this.getAdjustArea(cvs);\n  var data = this.getGridData(cvs, area);\n\n  this.setSize(cvs, area.size);\n  this.drawArea({\n    cvs: cvs,\n    data: data,\n    area: { x: 0, y: 0, size: area.size * window.devicePixelRatio },\n    style: function style(v) {\n      return 'rgba(0, 0, 0, ' + v + ')';\n    }\n  });\n\n  fontLib.push({\n    value: str,\n    data: data,\n    img: cvs.toDataURL(),\n    size: area.size\n  });\n};\n\nexports.fixFont = function (fontLibItem, gridData) {\n  fontLibItem.data = this.combineArray(fontLibItem.data, gridData);\n  this.setSize(this._canvas, fontLibItem.size);\n  this.clearCanvas(this._canvas);\n  this.drawGridData({\n    cvs: this._canvas,\n    gridData: fontLibItem.data,\n    rect: {\n      X: 0,\n      Y: 0,\n      size: fontLibItem.size\n    },\n    fillStyle: function fillStyle(v) {\n      return 'rgba(0, 0, 0, ' + v + ')';\n    }\n  });\n  fontLibItem.img = this._canvas.toDataURL();\n};\n\nexports.drawArea = function (_ref) {\n  var cvs = _ref.cvs,\n      data = _ref.data,\n      area = _ref.area,\n      style = _ref.style,\n      compare = _ref.compare;\n\n  var ctx = cvs.getContext('2d');\n  var step = area.size / config.grid;\n  for (var y = 0; y < config.grid; y++) {\n    for (var x = 0; x < config.grid; x++) {\n      var index = x + y * config.grid;\n      if (compare) {\n        console.log(data[index], compare[index]);\n        ctx.fillStyle = style(data[index], compare[index]);\n      } else {\n        ctx.fillStyle = style(data[index]);\n      }\n      ctx.fillRect(area.x + x * step, area.x + y * step, step, step);\n    }\n  }\n};\n\nexports.drawAreaBorder = function (_ref2) {\n  var cvs = _ref2.cvs,\n      area = _ref2.area,\n      style = _ref2.style;\n\n  var ctx = cvs.getContext('2d');\n  ctx.strokeStyle = style;\n  ctx.lineWidth = 1;\n  ctx.strokeRect(area.x, area.y, area.size, area.size);\n};\n\nexports.getDetectArea = function (cvs) {\n  var imageData = cvs.getContext('2d').getImageData(0, 0, cvs.width, cvs.height);\n  var arr = this.convertImageData(imageData.data);\n  var rect = {};\n\n  arr.forEach(function (v, i) {\n    if (v) {\n      var y = Math.floor(i / cvs.width);\n      var x = Math.floor(i % cvs.width);\n\n      if (rect.XStart === undefined) {\n        rect.XStart = x;\n        rect.XEnd = x;\n        rect.YStart = y;\n        rect.YEnd = y;\n        return;\n      }\n\n      if (x < rect.XStart) {\n        rect.XStart = x;\n      }\n\n      if (x > rect.XEnd) {\n        rect.XEnd = x;\n      }\n\n      if (y < rect.YStart) {\n        rect.YStart = y;\n      }\n\n      if (y > rect.YEnd) {\n        rect.YEnd = y;\n      }\n    }\n  });\n\n  var XOffset = rect.XEnd - rect.XStart;\n  var YOffset = rect.YEnd - rect.YStart;\n\n  if (YOffset >= XOffset) {\n    rect.y = rect.YStart;\n    rect.x = Math.floor(rect.XStart - (YOffset - XOffset) / 2);\n    rect.size = YOffset;\n  }\n\n  if (YOffset < XOffset) {\n    rect.x = rect.XStart;\n    rect.y = Math.floor(rect.YStart - (XOffset - YOffset) / 2);\n    rect.size = XOffset;\n  }\n\n  return rect;\n};\n\nexports.adjustArea = function (rect) {\n  var offset = rect.size % config.grid;\n  if (offset === 0) {\n    return rect;\n  }\n\n  var toFixed = config.grid - offset;\n  var half = Math.floor(toFixed / 2);\n\n  return {\n    x: rect.x - half,\n    y: rect.y - half,\n    size: rect.size + toFixed\n  };\n};\n\nexports.getAdjustArea = function (cvs) {\n  return this.adjustArea(this.getDetectArea(cvs));\n};\n\nexports.getGridData = function (cvs, area) {\n  var imageData = cvs.getContext('2d').getImageData(area.x, area.y, area.size, area.size);\n  var arr = this.convertImageData(imageData.data);\n  var size = area.size;\n  var grid = config.grid;\n  var step = size / grid;\n  var gridData = [];\n  for (var x = 0; x < grid; x++) {\n    for (var y = 0; y < grid; y++) {\n      var px = [];\n      for (var xx = 0; xx < step; xx++) {\n        for (var yy = 0; yy < step; yy++) {\n          px.push(arr[y * step + x * size * step + yy + xx * size]);\n        }\n      }\n      var percent = px.filter(function (p) {\n        return !!p;\n      }).length / px.length;\n      gridData[y + x * grid] = percent > config.accept ? percent : 0;\n    }\n  }\n  return gridData;\n};\n\nexports.initFontLib = function () {\n  for (var i = 48; i < 91; i++) {\n    if (i > 57 && i < 65) {\n      continue;\n    }\n    this.addFont(String.fromCharCode(i), 'sans-serif');\n  }\n};\n\nexports.findMatch = function (data) {\n  var _this = this;\n\n  fontLib.forEach(function (font) {\n    font.acc = _this.compareArray(data, font.data);\n  });\n  fontLib.sort(function (a, b) {\n    return b.acc - a.acc;\n  });\n  return fontLib[0];\n};\n\n/***/ }),\n\n/***/ 29:\n/***/ (function(module, exports) {\n\nmodule.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    attrs: {\n      \"id\": \"home\"\n    }\n  }, [_c('canvas', {\n    ref: \"cvs\"\n  }), _vm._v(\" \"), _c('p', {\n    attrs: {\n      \"id\": \"msg\"\n    }\n  }, [_vm._v(_vm._s(_vm.msg))]), _vm._v(\" \"), _c('div', {\n    directives: [{\n      name: \"show\",\n      rawName: \"v-show\",\n      value: (_vm.state === 2),\n      expression: \"state === 2\"\n    }],\n    attrs: {\n      \"id\": \"match\"\n    }\n  }, [_c('canvas', {\n    ref: \"match\"\n  }), _vm._v(\" \"), _c('img', {\n    ref: \"img\",\n    attrs: {\n      \"src\": _vm.imgSrc,\n      \"alt\": \"img\"\n    }\n  })]), _vm._v(\" \"), _c('div', {\n    directives: [{\n      name: \"show\",\n      rawName: \"v-show\",\n      value: (_vm.state === 2),\n      expression: \"state === 2\"\n    }],\n    attrs: {\n      \"id\": \"btns\"\n    }\n  }, [_c('button', {\n    on: {\n      \"click\": _vm.confirm\n    }\n  }, [_vm._v(\"是\")]), _vm._v(\" \"), _c('button', {\n    on: {\n      \"click\": _vm.reset\n    }\n  }, [_vm._v(\"否\")])])])\n},staticRenderFns: []}\n\n/***/ }),\n\n/***/ 7:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 8:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 9:\n/***/ (function(module, exports, __webpack_require__) {\n\nvar Component = __webpack_require__(28)(\n  /* script */\n  __webpack_require__(13),\n  /* template */\n  __webpack_require__(29),\n  /* scopeId */\n  null,\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n/***/ })\n\n},[12]);\n\n\n// WEBPACK FOOTER //\n// static/js/app.d811a8944323bc667670.js","const lib = require('./lib')\nconst { config } = lib\n\nexport default class Element {\n  constructor (cvs, size = config.canvas.size) {\n    if (cvs === undefined) {\n      cvs = document.createElement('canvas')\n    }\n    this.cvs = cvs\n    this.size = size\n    this.callback = {}\n    this.init(cvs)\n  }\n\n  init (cvs) {\n    lib.setSize(cvs, this.size)\n    this.addEvent(['mousedown', 'touchstart'], this.drawStart)\n    this.addEvent(['mouseup', 'mouseleave', 'mouseenter', 'touchend'], this.drawEnd)\n    this.addEvent(['mousemove', 'touchmove'], this.drawing)\n  }\n\n  addEvent (arr, fn) {\n    arr.forEach(name => {\n      this.cvs.addEventListener(name, e => {\n        fn.call(this, e)\n        e.preventDefault()\n      })\n    })\n  }\n\n  drawing (e) {\n    if (!this._line) {\n      return\n    }\n    clearTimeout(this._afterDraw)\n    if (e.touches && e.touches[0]) {\n      e.offsetX = e.touches[0].pageX\n      e.offsetY = e.touches[0].pageY\n    }\n    this._line.add(e.offsetX, e.offsetY)\n  }\n\n  drawStart () {\n    this.stashPop()\n    this._line = new Line(this.cvs)\n  }\n\n  drawEnd () {\n    this._line = null\n    this._afterDraw = setTimeout(this.afterDraw.bind(this), 600)\n  }\n\n  afterDraw () {\n    this.stash()\n    const area = this.getAdjustDetectArea()\n    const data = lib.getGridData(this.cvs, area)\n    this.callback.finish(data)\n    lib.drawAreaBorder({\n      cvs: this.cvs,\n      area,\n      style: 'rgba(255, 0, 0, 0.5)'\n    })\n  }\n\n  stash () {\n    this._snapshot = this.cvs.getContext('2d').getImageData(0, 0, this.cvs.width, this.cvs.height)\n  }\n\n  stashPop () {\n    if (!this._snapshot) { return }\n    this.cvs.getContext('2d').putImageData(this._snapshot, 0, 0)\n    this._snapshot = null\n  }\n\n  clear () {\n    this._snapshot = null\n    lib.clearCanvas(this.cvs)\n  }\n\n  getDetectArea () {\n    return lib.getDetectArea(this.cvs)\n  }\n\n  getAdjustDetectArea () {\n    return lib.getAdjustArea(this.cvs)\n  }\n}\n\nclass Line {\n  constructor (cvs) {\n    this.cvs = cvs\n    this.ctx = cvs.getContext('2d')\n    this.ratio = window.devicePixelRatio\n  }\n\n  add (x, y) {\n    x *= this.ratio\n    y *= this.ratio\n    if (this._last) {\n      this.drawLine(this._last, { x, y })\n    }\n    this.drawArc(x, y)\n    this._last = { x, y }\n  }\n\n  drawLine (p, n) {\n    this.ctx.beginPath()\n    this.ctx.moveTo(p.x, p.y)\n    this.ctx.lineTo(n.x, n.y)\n    this.ctx.lineWidth = config.pen.size * 2\n    this.ctx.strokeStyle = config.pen.fillStyle\n    this.ctx.stroke()\n  }\n\n  drawArc (x, y) {\n    this.ctx.beginPath()\n    this.ctx.arc(x, y, config.pen.size, 0, Math.PI * 2)\n    this.ctx.fillStyle = config.pen.fillStyle\n    this.ctx.fill()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Canvas.js","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport home from './home'\nimport 'normalize.css'\nimport './index.less'\n\nVue.config.productionTip = false\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  template: '<home/>',\n  components: { home }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","<template>\n  <div id=\"home\">\n    <canvas ref=\"cvs\"></canvas>\n    <p id=\"msg\">{{msg}}</p>\n    <div id=\"match\" v-show=\"state === 2\">\n      <canvas ref=\"match\"></canvas>\n      <img ref=\"img\" :src=\"imgSrc\" alt=\"img\">\n    </div>\n    <div id=\"btns\" v-show=\"state === 2\">\n      <button @click=\"confirm\">是</button>\n      <button @click=\"reset\">否</button>\n    </div>\n  </div>\n</template>\n\n<script>\n  import Canvas from './Canvas'\n  import lib from './lib'\n\n  const config = lib.config\n\n  const STATE_MSG = {\n    0: '正在初始化数据...',\n    1: '在上方画布开始绘画',\n    2: '识别是否准确？'\n  }\n\n  export default {\n    data () {\n      return {\n        state: 0,\n        fontLib: lib.fontLib,\n        imgSrc: ''\n      }\n    },\n    computed: {\n      msg () {\n        return STATE_MSG[this.state]\n      }\n    },\n    created () {\n      setTimeout(() => {\n        lib.initFontLib()\n        this.state = 1\n      }, 0)\n    },\n    mounted () {\n      this.$nextTick(this.init)\n    },\n    methods: {\n      init () {\n        this._canvas = new Canvas(this.$refs.cvs)\n        this._match = new Canvas(this.$refs.match, config.grid * 4)\n\n        this._canvas.callback.finish = data => {\n          this.state = 2\n          const matched = lib.findMatch(data)\n          lib.setSize(this.$refs.img, config.grid * 4)\n          this.imgSrc = matched.img\n\n          lib.drawArea({\n            cvs: this.$refs.match,\n            data: data,\n            area: { x: 0, y: 0, size: this.$refs.match.width },\n            compare: matched.data,\n            style: (a, b) => {\n              if (a === 0 && b > 0) {\n                return `rgba(255, 0, 0, ${b / 2})`\n              }\n              if (b === 0 && a > 0) {\n                return `rgba(0, 0, 0, ${a})`\n              }\n              if (a === 0 && b === 0) {\n                return '#fff'\n              }\n              return `rgba(0, 255, 0, ${1 - Math.abs(a - b)})`\n            }\n          })\n        }\n      },\n\n      reset () {\n        this.state = 1\n        this._canvas.clear()\n      },\n\n      confirm () {\n        this.state = 1\n        this._canvas.clear()\n      }\n    }\n  }\n</script>\n\n\n\n// WEBPACK FOOTER //\n// home.vue?fb7c8b7a","const config = {\n  pen: {\n    size: 10,\n    fillStyle: '#000'\n  },\n  canvas: {\n    width: 200,\n    height: 200,\n    size: window.innerWidth > 400 ? 400 : window.innerWidth\n  },\n  grid: 32,\n  like: 0.1,\n  accept: 0.6,\n  grayThreshold: 128\n}\n\nconst fontLib = []\n\nexports.config = config\nexports.fontLib = fontLib\n\n/**\n * grid data\n * @typedef {Array} GridData\n *\n */\n\n/**\n * convert ImageData into gray Array\n * @param {Uint8ClampedArray} data\n * @return {Array}\n */\nexports.convertImageData = function (data) {\n  const arr = []\n  for (let i = 0; i < data.length; i += 4) {\n    if (data[i + 3] === 0) {\n      arr.push(0)\n      continue\n    }\n    if ((data[i] + data[i + 1] + data[i + 2]) > config.grayThreshold * 3) {\n      arr.push(0)\n    } else {\n      arr.push(1)\n    }\n  }\n  return arr\n}\n\nexports.compareArray = function (a, b) {\n  let matched = 0\n  a.forEach((v, i) => {\n    if (v === 0 && b[i] === 0) {\n      return\n    }\n    if (Math.abs(v - b[i]) < config.like) {\n      matched++\n    }\n  })\n  const validPoint = a.filter(v => v > 0).length + b.filter(v => v > 0).length\n  return parseFloat(matched / validPoint).toFixed(4)\n}\n\nexports.combineArray = function (a, b) {\n  const arr = []\n  a.forEach((v, i) => {\n    arr.push((v + b[i]) / 2)\n  })\n  return arr\n}\n\n/**\n * set canvas size\n * @param {Element} cvs\n * @param {Number} size\n */\nexports.setSize = function (cvs, size) {\n  cvs.width = size * window.devicePixelRatio\n  cvs.height = size * window.devicePixelRatio\n  cvs.style.width = size + 'px'\n  cvs.style.height = size + 'px'\n}\n\n/**\n * clear canvas\n * @param {Element} cvs\n */\nexports.clearCanvas = function (cvs) {\n  cvs.getContext('2d').clearRect(0, 0, cvs.width, cvs.height)\n}\n\n/**\n * add font to fontLib\n * @param {String|Number} str\n * @param {Object} fontStyle\n */\nexports.addFont = function (str, font) {\n  if (this._canvas === undefined) {\n    this._canvas = document.createElement('canvas')\n  }\n  const cvs = this._canvas\n  this.setSize(cvs, config.grid * 4)\n  const ctx = cvs.getContext('2d')\n\n  this.clearCanvas(cvs)\n  ctx.font = `200 ${cvs.height / 2}px ${font}`\n  ctx.textAlign = 'center'\n  ctx.fillStyle = '#000'\n  ctx.fillText(str, cvs.width / 2, cvs.height / 2)\n\n  const area = this.getAdjustArea(cvs)\n  const data = this.getGridData(cvs, area)\n\n  this.setSize(cvs, area.size)\n  this.drawArea({\n    cvs,\n    data,\n    area: { x: 0, y: 0, size: area.size * window.devicePixelRatio },\n    style: v => `rgba(0, 0, 0, ${v})`\n  })\n\n  fontLib.push({\n    value: str,\n    data,\n    img: cvs.toDataURL(),\n    size: area.size\n  })\n}\n\nexports.fixFont = function (fontLibItem, gridData) {\n  fontLibItem.data = this.combineArray(fontLibItem.data, gridData)\n  this.setSize(this._canvas, fontLibItem.size)\n  this.clearCanvas(this._canvas)\n  this.drawGridData({\n    cvs: this._canvas,\n    gridData: fontLibItem.data,\n    rect: {\n      X: 0,\n      Y: 0,\n      size: fontLibItem.size\n    },\n    fillStyle: v => `rgba(0, 0, 0, ${v})`\n  })\n  fontLibItem.img = this._canvas.toDataURL()\n}\n\n/**\n * drawGridData\n * @param {Element} cvs\n * @param {GridData} data\n * @param {{X, Y, size}} area\n */\nexports.drawArea = function ({ cvs, data, area, style, compare }) {\n  const ctx = cvs.getContext('2d')\n  const step = area.size / config.grid\n  for (let y = 0; y < config.grid; y++) {\n    for (let x = 0; x < config.grid; x++) {\n      const index = x + y * config.grid\n      if (compare) {\n        console.log(data[index], compare[index])\n        ctx.fillStyle = style(data[index], compare[index])\n      } else {\n        ctx.fillStyle = style(data[index])\n      }\n      ctx.fillRect(area.x + x * step, area.x + y * step, step, step)\n    }\n  }\n}\n\n/**\n * drawAreaBorder\n * @param {Element} cvs\n * @param {{X, Y, size}} area\n */\nexports.drawAreaBorder = function ({ cvs, area, style }) {\n  const ctx = cvs.getContext('2d')\n  ctx.strokeStyle = style\n  ctx.lineWidth = 1\n  ctx.strokeRect(area.x, area.y, area.size, area.size)\n}\n\n/**\n * detect text area from canvas\n * @param {Element} cvs\n * @return {{ x, y, size }}\n */\nexports.getDetectArea = function (cvs) {\n  const imageData = cvs.getContext('2d').getImageData(0, 0, cvs.width, cvs.height)\n  const arr = this.convertImageData(imageData.data)\n  const rect = {}\n\n  arr.forEach((v, i) => {\n    if (v) {\n      const y = Math.floor(i / cvs.width)\n      const x = Math.floor(i % cvs.width)\n\n      if (rect.XStart === undefined) {\n        rect.XStart = x\n        rect.XEnd = x\n        rect.YStart = y\n        rect.YEnd = y\n        return\n      }\n\n      if (x < rect.XStart) {\n        rect.XStart = x\n      }\n\n      if (x > rect.XEnd) {\n        rect.XEnd = x\n      }\n\n      if (y < rect.YStart) {\n        rect.YStart = y\n      }\n\n      if (y > rect.YEnd) {\n        rect.YEnd = y\n      }\n    }\n  })\n\n  const XOffset = rect.XEnd - rect.XStart\n  const YOffset = rect.YEnd - rect.YStart\n\n  if (YOffset >= XOffset) {\n    rect.y = rect.YStart\n    rect.x = Math.floor(rect.XStart - (YOffset - XOffset) / 2)\n    rect.size = YOffset\n  }\n\n  if (YOffset < XOffset) {\n    rect.x = rect.XStart\n    rect.y = Math.floor(rect.YStart - (XOffset - YOffset) / 2)\n    rect.size = XOffset\n  }\n\n  return rect\n}\n\n/**\n * adjust area to grid size\n * @param {{ x, y, size }} rect\n * @return {{ x, y, size }}\n */\nexports.adjustArea = function (rect) {\n  const offset = rect.size % config.grid\n  if (offset === 0) {\n    return rect\n  }\n\n  const toFixed = config.grid - offset\n  const half = Math.floor(toFixed / 2)\n\n  return {\n    x: rect.x - half,\n    y: rect.y - half,\n    size: rect.size + toFixed\n  }\n}\n\n/**\n * detect text area from canvas (adjusted)\n * @param {Element} cvs\n * @return {{ x, y, size }}\n */\nexports.getAdjustArea = function (cvs) {\n  return this.adjustArea(this.getDetectArea(cvs))\n}\n\n/**\n * get grid data\n * @param {Element} cvs\n * @param {{ x, y, size }} area\n * @return {Array}\n */\nexports.getGridData = function (cvs, area) {\n  const imageData = cvs.getContext('2d').getImageData(area.x, area.y, area.size, area.size)\n  const arr = this.convertImageData(imageData.data)\n  const size = area.size\n  const grid = config.grid\n  const step = size / grid\n  const gridData = []\n  for (let x = 0; x < grid; x++) {\n    for (let y = 0; y < grid; y++) {\n      const px = []\n      for (let xx = 0; xx < step; xx++) {\n        for (let yy = 0; yy < step; yy++) {\n          px.push(arr[y * step + x * size * step + yy + xx * size])\n        }\n      }\n      const percent = px.filter(p => !!p).length / px.length\n      gridData[y + x * grid] = percent > config.accept ? percent : 0\n    }\n  }\n  return gridData\n}\n\n/**\n * init fontLib with 0-9 a-z\n */\nexports.initFontLib = function () {\n  for (let i = 48; i < 91; i++) {\n    if (i > 57 && i < 65) {\n      continue\n    }\n    this.addFont(String.fromCharCode(i), `sans-serif`)\n  }\n}\n\n/**\n * find best match font\n * @param {Array} data\n */\nexports.findMatch = function (data) {\n  fontLib.forEach(font => {\n    font.acc = this.compareArray(data, font.data)\n  })\n  fontLib.sort((a, b) => b.acc - a.acc)\n  return fontLib[0]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib.js","module.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    attrs: {\n      \"id\": \"home\"\n    }\n  }, [_c('canvas', {\n    ref: \"cvs\"\n  }), _vm._v(\" \"), _c('p', {\n    attrs: {\n      \"id\": \"msg\"\n    }\n  }, [_vm._v(_vm._s(_vm.msg))]), _vm._v(\" \"), _c('div', {\n    directives: [{\n      name: \"show\",\n      rawName: \"v-show\",\n      value: (_vm.state === 2),\n      expression: \"state === 2\"\n    }],\n    attrs: {\n      \"id\": \"match\"\n    }\n  }, [_c('canvas', {\n    ref: \"match\"\n  }), _vm._v(\" \"), _c('img', {\n    ref: \"img\",\n    attrs: {\n      \"src\": _vm.imgSrc,\n      \"alt\": \"img\"\n    }\n  })]), _vm._v(\" \"), _c('div', {\n    directives: [{\n      name: \"show\",\n      rawName: \"v-show\",\n      value: (_vm.state === 2),\n      expression: \"state === 2\"\n    }],\n    attrs: {\n      \"id\": \"btns\"\n    }\n  }, [_c('button', {\n    on: {\n      \"click\": _vm.confirm\n    }\n  }, [_vm._v(\"是\")]), _vm._v(\" \"), _c('button', {\n    on: {\n      \"click\": _vm.reset\n    }\n  }, [_vm._v(\"否\")])])])\n},staticRenderFns: []}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-loader/lib/template-compiler?{\"id\":\"data-v-9c316dee\"}!./~/vue-loader/lib/selector.js?type=template&index=0!./src/home.vue\n// module id = 29\n// module chunks = 1","var Component = require(\"!../node_modules/vue-loader/lib/component-normalizer\")(\n  /* script */\n  require(\"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./home.vue\"),\n  /* template */\n  require(\"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-9c316dee\\\"}!../node_modules/vue-loader/lib/selector?type=template&index=0!./home.vue\"),\n  /* scopeId */\n  null,\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/home.vue\n// module id = 9\n// module chunks = 1"],"sourceRoot":""}