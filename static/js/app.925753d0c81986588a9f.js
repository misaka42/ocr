webpackJsonp([1],[,function(t,e){var a={pen:{size:12,fillStyle:"#000"},canvas:{width:200,height:200,size:window.innerWidth>400?400:window.innerWidth},grid:32,like:.1,accept:.6,grayThreshold:128},i=[],s={};e.config=a,e.fontLib=i,e.userDraw=s,e.convertImageData=function(t){for(var e=[],i=0;i<t.length;i+=4)0!==t[i+3]?t[i]+t[i+1]+t[i+2]>3*a.grayThreshold&&t[i+3]<a.accept?e.push(0):e.push(1):e.push(0);return e},e.compareArray=function(t,e){var i=0;t.forEach(function(t,s){0===t&&0===e[s]||Math.abs(t-e[s])<a.like&&i++});var s=t.filter(function(t){return t>0}).length+e.filter(function(t){return t>0}).length;return parseFloat(i/s).toFixed(4)},e.combineArray=function(t,e,a){a=a||.5;var i=[];return t.forEach(function(t,s){i.push(t*(1-a)+e[s]*a)}),i},e.setSize=function(t,e){t.width=e*window.devicePixelRatio,t.height=e*window.devicePixelRatio,t.style.width=e+"px",t.style.height=e+"px"},e.clearCanvas=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},e.addFont=function(t,e){void 0===this._canvas&&(this._canvas=document.createElement("canvas"));var s=this._canvas;this.setSize(s,4*a.grid);var n=s.getContext("2d");this.clearCanvas(s),n.font="200 "+s.height/2+"px "+e,n.textAlign="center",n.fillStyle="#000",n.fillText(t,s.width/2,s.height/2);var r=this.getAdjustArea(s),c=this.getGridData(s,r);this.setSize(s,r.size),this.drawArea({cvs:s,data:c,area:{x:0,y:0,size:r.size*window.devicePixelRatio},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),i.push({value:t,data:c,img:s.toDataURL(),size:r.size})},e.addCustomFont=function(t){var e=this._canvas,n=s.data;this.setSize(e,a.canvas.size),this.clearCanvas(e),this.drawArea({cvs:e,data:n,area:{x:0,y:0,size:this._canvas.width},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),i.push({value:t,data:n,img:e.toDataURL(),size:a.canvas.size})},e.fixFont=function(t,e){this.setSize(this._canvas,t.size),this.clearCanvas(this._canvas),this.drawArea({cvs:this._canvas,data:s.data,compare:t.data,area:{x:0,y:0,size:this._canvas.width},style:function(t,a){return"rgba(0, 0, 0, "+(t*(1-e)+a*e)+")"}}),t.data=this.getAdjustGridData(this._canvas,.9),this.drawArea({cvs:this._canvas,data:t.data,area:{x:0,y:0,size:this._canvas.width},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),t.img=this._canvas.toDataURL()},e.drawArea=function(t){var e=t.cvs,i=t.data,s=t.area,n=t.style,r=t.compare,c=e.getContext("2d");this.clearCanvas(e);for(var o=s.size/a.grid,h=0;h<a.grid;h++)for(var u=0;u<a.grid;u++){var d=u+h*a.grid;c.fillStyle=r?n(i[d],r[d]):n(i[d]),c.fillRect(s.x+u*o,s.x+h*o,o,o)}},e.drawAreaBorder=function(t){var e=t.cvs,a=t.area,i=t.style,s=e.getContext("2d");s.strokeStyle=i,s.lineWidth=1,s.strokeRect(a.x,a.y,a.size,a.size)},e.getDetectArea=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height),a=this.convertImageData(e.data),i={};a.forEach(function(e,a){if(e){var s=Math.floor(a/t.width),n=Math.floor(a%t.width);if(void 0===i.XStart)return i.XStart=n,i.XEnd=n,i.YStart=s,void(i.YEnd=s);n<i.XStart&&(i.XStart=n),n>i.XEnd&&(i.XEnd=n),s<i.YStart&&(i.YStart=s),s>i.YEnd&&(i.YEnd=s)}});var s=i.XEnd-i.XStart,n=i.YEnd-i.YStart;return n>=s&&(i.y=i.YStart,i.x=Math.floor(i.XStart-(n-s)/2),i.size=n),n<s&&(i.x=i.XStart,i.y=Math.floor(i.YStart-(s-n)/2),i.size=s),i},e.adjustArea=function(t){var e=t.size%a.grid;if(0===e)return t;var i=a.grid-e,s=Math.floor(i/2);return{x:t.x-s,y:t.y-s,size:t.size+i}},e.getAdjustArea=function(t){return this.adjustArea(this.getDetectArea(t))},e.getGridData=function(t,e,i){i=i||a.accept;for(var s=t.getContext("2d").getImageData(e.x,e.y,e.size,e.size),n=this.convertImageData(s.data),r=e.size,c=a.grid,o=r/c,h=[],u=0;u<c;u++)for(var d=0;d<c;d++){for(var v=[],l=0;l<o;l++)for(var f=0;f<o;f++)v.push(n[d*o+u*r*o+f+l*r]);var g=v.filter(function(t){return!!t}).length/v.length;h[d+u*c]=g>i?g:0}return h},e.getAdjustGridData=function(t,e){var a=this.getAdjustArea(t);return this.getGridData(t,a,e)},e.initFontLib=function(){if(!i.length)for(var t=48;t<91;t++)t>57&&t<65||this.addFont(String.fromCharCode(t),"sans-serif")},e.findMatch=function(t){var e=this;return i.forEach(function(a){a.acc=e.compareArray(t,a.data)}),s.data=t,i.sort(function(t,e){return e.acc-t.acc}),i[0]}},,function(t,e,a){"use strict";var i=a(19),s=a.n(i),n=a(20),r=a.n(n),c=a(1),o=c.config,h=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.canvas.size,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];s()(this,t),void 0===e&&(e=document.createElement("canvas")),this.cvs=e,this.size=a,this.canDraw=i,this.callback={},this.init(e)}return r()(t,[{key:"init",value:function(t){c.setSize(t,this.size),this.canDraw&&(this.addEvent(["mousedown","touchstart"],this.drawStart),this.addEvent(["mouseup","mouseleave","mouseenter","touchend"],this.drawEnd),this.addEvent(["mousemove","touchmove"],this.drawing))}},{key:"addEvent",value:function(t,e){var a=this;t.forEach(function(t){a.cvs.addEventListener(t,function(t){e.call(a,t),t.preventDefault()})})}},{key:"drawing",value:function(t){this._line&&(clearTimeout(this._afterDraw),t.touches&&t.touches[0]&&(t.offsetX=t.touches[0].pageX,t.offsetY=t.touches[0].pageY),this._line.add(t.offsetX,t.offsetY))}},{key:"drawStart",value:function(){this.stashPop(),this._line=new u(this.cvs)}},{key:"drawEnd",value:function(){this._line=null,this._afterDraw=setTimeout(this.afterDraw.bind(this),600)}},{key:"afterDraw",value:function(){this.stash();var t=this.getAdjustDetectArea(),e=c.getGridData(this.cvs,t);this.callback.finish&&this.callback.finish(e),c.drawAreaBorder({cvs:this.cvs,area:t,style:"rgba(255, 0, 0, 0.5)"})}},{key:"stash",value:function(){this._snapshot=this.cvs.getContext("2d").getImageData(0,0,this.cvs.width,this.cvs.height)}},{key:"stashPop",value:function(){this._snapshot&&(this.cvs.getContext("2d").putImageData(this._snapshot,0,0),this._snapshot=null)}},{key:"clear",value:function(){this._snapshot=null,c.clearCanvas(this.cvs)}},{key:"getDetectArea",value:function(){return c.getDetectArea(this.cvs)}},{key:"getAdjustDetectArea",value:function(){return c.getAdjustArea(this.cvs)}}]),t}();e.a=h;var u=function(){function t(e){s()(this,t),this.cvs=e,this.ctx=e.getContext("2d"),this.ratio=window.devicePixelRatio}return r()(t,[{key:"add",value:function(t,e){t*=this.ratio,e*=this.ratio,this._last&&this.drawLine(this._last,{x:t,y:e}),this.drawArc(t,e),this._last={x:t,y:e}}},{key:"drawLine",value:function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.lineWidth=2*o.pen.size,this.ctx.strokeStyle=o.pen.fillStyle,this.ctx.stroke()}},{key:"drawArc",value:function(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,o.pen.size,0,2*Math.PI),this.ctx.fillStyle=o.pen.fillStyle,this.ctx.fill()}}]),t}()},,,,,,function(t,e){},function(t,e){},function(t,e,a){var i=a(8)(a(16),a(33),null,null);t.exports=i.exports},function(t,e,a){var i=a(8)(a(17),a(32),null,null);t.exports=i.exports},,,function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(14),s=a(13),n=a(11),r=a.n(n),c=a(12),o=a.n(c),h=a(9),u=(a.n(h),a(10));a.n(u);i.a.config.productionTip=!1,i.a.use(s.a);var d=[{path:"/",component:r.a},{path:"/identify",component:o.a}],v=new s.a({routes:d});new i.a({router:v}).$mount("#app")},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(3),s=a(1),n=a.n(s),r=n.a.config,c={0:"正在初始化数据...",1:"在上方画布开始绘画",2:"识别是否准确？"};e.default={data:function(){return{state:0,fontLib:n.a.fontLib,imgSrc:""}},computed:{msg:function(){return 2===this.state?"「 "+this.fontLib[0].value+" 」 "+c[this.state]:c[this.state]}},created:function(){var t=this;setTimeout(function(){n.a.initFontLib(),t.state=1},0)},mounted:function(){this.$nextTick(this.init)},methods:{init:function(){var t=this;this._canvas=new i.a(this.$refs.cvs),this._match=new i.a(this.$refs.match,4*r.grid,!1),this._canvas.callback.finish=function(e){t.state=2;var a=n.a.findMatch(e);n.a.setSize(t.$refs.img,4*r.grid),t.imgSrc=a.img,n.a.drawArea({cvs:t.$refs.match,data:e,area:{x:0,y:0,size:t.$refs.match.width},compare:a.data,style:function(t,e){return 0===t&&e>0?"rgba(255, 0, 0, "+e/2+")":0===e&&t>0?"rgba(0, 0, 0, "+t+")":0===t&&0===e?"#fff":"rgba(0, 255, 0, "+(1-Math.abs(t-e))+")"}})}},reset:function(){this.state=1,this._canvas.clear(),this.$router.push({path:"/identify"})},confirm:function(){this.state=1,this._canvas.clear(),n.a.fixFont(this.fontLib[0],.1)}}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(1),s=a.n(i),n=a(3);e.default={data:function(){return{list:s.a.fontLib,pickedItem:null}},methods:{pick:function(t){if(this.pickedItem===t)this.pickedItem=null;else{this.pickedItem=t;var e=new n.a(this.$refs.cvs,200);s.a.drawArea({cvs:e.cvs,data:s.a.userDraw.data,compare:t.data,area:{x:0,y:0,size:e.cvs.width},style:function(t,e){return 0===t&&e>0?"rgba(255, 0, 0, "+e/2+")":0===e&&t>0?"rgba(0, 0, 0, "+t+")":0===t&&0===e?"#fff":"rgba(0, 255, 0, "+(1-Math.abs(t-e))+")"}})}},confirm:function(){s.a.fixFont(this.pickedItem,.8),this.pickedItem=null,this.$router.push({path:"/"})},reset:function(){this.pickedItem=null},custom:function(){s.a.addCustomFont(window.prompt("给你画的东西起个名字吧"))}}}},,,,,,,,,,,,,,,function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"Identify"}},[a("div",{staticClass:"title"},[a("router-link",{attrs:{to:"/"}},[t._v("返回")]),t._v("选择你想画的图形")],1),t._v(" "),a("div",{staticClass:"imgs"},t._l(t.list,function(e){return a("div",{staticClass:"img-box",class:{active:e===t.pickedItem},on:{click:function(a){t.pick(e)}}},[a("img",{attrs:{src:e.img,alt:e.value}}),t._v(" "),a("i",[t._v(t._s(e.acc))])])})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.pickedItem,expression:"pickedItem"}],staticClass:"confirm"},[t._m(0),t._v(" "),a("canvas",{ref:"cvs"}),t._v(" "),a("div",{staticClass:"desc"},[a("div",[t._v("字符 "+t._s(t.pickedItem&&t.pickedItem.value))]),t._v(" "),a("div",[t._v("符合率 "+t._s(t.pickedItem&&t.pickedItem.acc))])]),t._v(" "),a("div",{staticClass:"bottom-btn-group"},[a("button",{on:{click:t.confirm}},[t._v("就他了")]),t._v(" "),a("button",{on:{click:t.reset}},[t._v("还是算了")])])]),t._v(" "),a("div",{staticClass:"btn",on:{click:t.custom}},[t._v("这里没有朕想要的")])])},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"tips"},[a("li",[t._v("你画的区域")]),t._v(" "),a("li",[t._v("字符的区域")]),t._v(" "),a("li",[t._v("重叠的区域")])])}]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"home"}},[a("canvas",{ref:"cvs"}),t._v(" "),a("p",{attrs:{id:"msg"}},[t._v(t._s(t.msg))]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],attrs:{id:"match"}},[a("canvas",{ref:"match"}),t._v(" "),a("img",{ref:"img",attrs:{src:t.imgSrc,alt:"img"}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],staticClass:"bottom-btn-group"},[a("button",{on:{click:t.confirm}},[t._v("是")]),t._v(" "),a("button",{on:{click:t.reset}},[t._v("否")])])])},staticRenderFns:[]}}],[15]);
//# sourceMappingURL=app.925753d0c81986588a9f.js.map