webpackJsonp([1],{11:function(t,e,i){"use strict";var a=i(15),n=i.n(a),s=i(16),r=i.n(s),c=i(2),o=c.config,h=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.canvas.size;n()(this,t),void 0===e&&(e=document.createElement("canvas")),this.cvs=e,this.size=i,this.callback={},this.init(e)}return r()(t,[{key:"init",value:function(t){c.setSize(t,this.size),this.addEvent(["mousedown","touchstart"],this.drawStart),this.addEvent(["mouseup","mouseleave","mouseenter","touchend"],this.drawEnd),this.addEvent(["mousemove","touchmove"],this.drawing)}},{key:"addEvent",value:function(t,e){var i=this;t.forEach(function(t){i.cvs.addEventListener(t,e.bind(i))})}},{key:"drawing",value:function(t){this._line&&(clearTimeout(this._afterDraw),t.touches&&t.touches[0]&&(t.offsetX=t.touches[0].pageX,t.offsetY=t.touches[0].pageY),this._line.add(t.offsetX,t.offsetY))}},{key:"drawStart",value:function(){this.stashPop(),this._line=new u(this.cvs)}},{key:"drawEnd",value:function(){this._line=null,this._afterDraw=setTimeout(this.afterDraw.bind(this),600)}},{key:"afterDraw",value:function(){this.stash();var t=this.getAdjustDetectArea(),e=c.getGridData(this.cvs,t);this.callback.finish(e),c.drawAreaBorder({cvs:this.cvs,area:t,style:"rgba(255, 0, 0, 0.5)"})}},{key:"stash",value:function(){this._snapshot=this.cvs.getContext("2d").getImageData(0,0,this.cvs.width,this.cvs.height)}},{key:"stashPop",value:function(){this._snapshot&&(this.cvs.getContext("2d").putImageData(this._snapshot,0,0),this._snapshot=null)}},{key:"clear",value:function(){this._snapshot=null,c.clearCanvas(this.cvs)}},{key:"getDetectArea",value:function(){return c.getDetectArea(this.cvs)}},{key:"getAdjustDetectArea",value:function(){return c.getAdjustArea(this.cvs)}}]),t}();e.a=h;var u=function(){function t(e){n()(this,t),this.cvs=e,this.ctx=e.getContext("2d"),this.ratio=window.devicePixelRatio}return r()(t,[{key:"add",value:function(t,e){t*=this.ratio,e*=this.ratio,this._last&&this.drawLine(this._last,{x:t,y:e}),this.drawArc(t,e),this._last={x:t,y:e}}},{key:"drawLine",value:function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.lineWidth=2*o.pen.size,this.ctx.strokeStyle=o.pen.fillStyle,this.ctx.stroke()}},{key:"drawArc",value:function(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,o.pen.size,0,2*Math.PI),this.ctx.fillStyle=o.pen.fillStyle,this.ctx.fill()}}]),t}()},12:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(10),n=i(9),s=i.n(n),r=i(7),c=(i.n(r),i(8));i.n(c);a.a.config.productionTip=!1,new a.a({el:"#app",template:"<home/>",components:{home:s.a}})},13:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(11),n=i(2),s=i.n(n),r=s.a.config,c={0:"正在初始化数据...",1:"在上方画布开始绘画",2:"识别是否准确？"};e.default={data:function(){return{state:0,fontLib:s.a.fontLib,imgSrc:""}},computed:{msg:function(){return c[this.state]}},created:function(){var t=this;setTimeout(function(){s.a.initFontLib(),t.state=1},0)},mounted:function(){this.$nextTick(this.init)},methods:{init:function(){var t=this;this._canvas=new a.a(this.$refs.cvs),this._match=new a.a(this.$refs.match,4*r.grid),this._canvas.callback.finish=function(e){t.state=2;var i=s.a.findMatch(e);s.a.setSize(t.$refs.img,4*r.grid),t.imgSrc=i.img,s.a.drawArea({cvs:t.$refs.match,data:e,area:{x:0,y:0,size:t.$refs.match.width},compare:i.data,style:function(t,e){return 0===t&&e>0?"rgba(255, 0, 0, "+e/2+")":0===e&&t>0?"rgba(0, 0, 0, "+t+")":0===t&&0===e?"#fff":"rgba(0, 255, 0, "+(1-Math.abs(t-e))+")"}})}},reset:function(){this.state=1,this._canvas.clear()},confirm:function(){this.state=1,this._canvas.clear()}}}},2:function(t,e){var i={pen:{size:10,fillStyle:"#000"},canvas:{width:200,height:200,size:window.innerWidth>400?400:window.innerWidth},grid:32,like:.1,accept:.6,grayThreshold:128},a=[];e.config=i,e.fontLib=a,e.convertImageData=function(t){for(var e=[],a=0;a<t.length;a+=4)0!==t[a+3]?t[a]+t[a+1]+t[a+2]>3*i.grayThreshold?e.push(0):e.push(1):e.push(0);return e},e.compareArray=function(t,e){var a=0;t.forEach(function(t,n){0===t&&0===e[n]||Math.abs(t-e[n])<i.like&&a++});var n=t.filter(function(t){return t>0}).length+e.filter(function(t){return t>0}).length;return parseFloat(a/n).toFixed(4)},e.combineArray=function(t,e){var i=[];return t.forEach(function(t,a){i.push((t+e[a])/2)}),i},e.setSize=function(t,e){t.width=e*window.devicePixelRatio,t.height=e*window.devicePixelRatio,t.style.width=e+"px",t.style.height=e+"px"},e.clearCanvas=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},e.addFont=function(t,e){void 0===this._canvas&&(this._canvas=document.createElement("canvas"));var n=this._canvas;this.setSize(n,4*i.grid);var s=n.getContext("2d");this.clearCanvas(n),s.font="200 "+n.height/2+"px "+e,s.textAlign="center",s.fillStyle="#000",s.fillText(t,n.width/2,n.height/2);var r=this.getAdjustArea(n),c=this.getGridData(n,r);this.setSize(n,r.size),this.drawArea({cvs:n,data:c,area:{x:0,y:0,size:r.size*window.devicePixelRatio},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),a.push({value:t,data:c,img:n.toDataURL(),size:r.size})},e.fixFont=function(t,e){t.data=this.combineArray(t.data,e),this.setSize(this._canvas,t.size),this.clearCanvas(this._canvas),this.drawGridData({cvs:this._canvas,gridData:t.data,rect:{X:0,Y:0,size:t.size},fillStyle:function(t){return"rgba(0, 0, 0, "+t+")"}}),t.img=this._canvas.toDataURL()},e.drawArea=function(t){for(var e=t.cvs,a=t.data,n=t.area,s=t.style,r=t.compare,c=e.getContext("2d"),o=n.size/i.grid,h=0;h<i.grid;h++)for(var u=0;u<i.grid;u++){var d=u+h*i.grid;r?(console.log(a[d],r[d]),c.fillStyle=s(a[d],r[d])):c.fillStyle=s(a[d]),c.fillRect(n.x+u*o,n.x+h*o,o,o)}},e.drawAreaBorder=function(t){var e=t.cvs,i=t.area,a=t.style,n=e.getContext("2d");n.strokeStyle=a,n.lineWidth=1,n.strokeRect(i.x,i.y,i.size,i.size)},e.getDetectArea=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height),i=this.convertImageData(e.data),a={};i.forEach(function(e,i){if(e){var n=Math.floor(i/t.width),s=Math.floor(i%t.width);if(void 0===a.XStart)return a.XStart=s,a.XEnd=s,a.YStart=n,void(a.YEnd=n);s<a.XStart&&(a.XStart=s),s>a.XEnd&&(a.XEnd=s),n<a.YStart&&(a.YStart=n),n>a.YEnd&&(a.YEnd=n)}});var n=a.XEnd-a.XStart,s=a.YEnd-a.YStart;return s>=n&&(a.y=a.YStart,a.x=Math.floor(a.XStart-(s-n)/2),a.size=s),s<n&&(a.x=a.XStart,a.y=Math.floor(a.YStart-(n-s)/2),a.size=n),a},e.adjustArea=function(t){var e=t.size%i.grid;if(0===e)return t;var a=i.grid-e,n=Math.floor(a/2);return{x:t.x-n,y:t.y-n,size:t.size+a}},e.getAdjustArea=function(t){return this.adjustArea(this.getDetectArea(t))},e.getGridData=function(t,e){for(var a=t.getContext("2d").getImageData(e.x,e.y,e.size,e.size),n=this.convertImageData(a.data),s=e.size,r=i.grid,c=s/r,o=[],h=0;h<r;h++)for(var u=0;u<r;u++){for(var d=[],f=0;f<c;f++)for(var v=0;v<c;v++)d.push(n[u*c+h*s*c+v+f*s]);var l=d.filter(function(t){return!!t}).length/d.length;o[u+h*r]=l>i.accept?l:0}return o},e.initFontLib=function(){for(var t=48;t<91;t++)t>57&&t<65||this.addFont(String.fromCharCode(t),"sans-serif")},e.findMatch=function(t){var e=this;return a.forEach(function(i){i.acc=e.compareArray(t,i.data)}),a.sort(function(t,e){return e.acc-t.acc}),a[0]}},29:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"home"}},[i("canvas",{ref:"cvs"}),t._v(" "),i("p",{attrs:{id:"msg"}},[t._v(t._s(t.msg))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],attrs:{id:"match"}},[i("canvas",{ref:"match"}),t._v(" "),i("img",{ref:"img",attrs:{src:t.imgSrc,alt:"img"}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],attrs:{id:"btns"}},[i("button",{on:{click:t.confirm}},[t._v("是")]),t._v(" "),i("button",{on:{click:t.reset}},[t._v("否")])])])},staticRenderFns:[]}},7:function(t,e){},8:function(t,e){},9:function(t,e,i){var a=i(28)(i(13),i(29),null,null);t.exports=a.exports}},[12]);
//# sourceMappingURL=app.f34249b8fcb28982f694.js.map