{"version":3,"sources":["webpack:///static/js/app.6c433207d8d214e67c72.js","webpack:///./src/main.js","webpack:///./src/util.js","webpack:///ocr.vue","webpack:///./src/ocr.vue?ea90","webpack:///./src/ocr.vue?84bb"],"names":["webpackJsonp","11","module","__webpack_exports__","__webpack_require__","Object","defineProperty","value","__WEBPACK_IMPORTED_MODULE_0_vue__","__WEBPACK_IMPORTED_MODULE_1__ocr__","__WEBPACK_IMPORTED_MODULE_1__ocr___default","n","config","productionTip","el","template","components","ocr","a","12","exports","pen","size","fillStyle","strokeStyle","canvas","width","height","grid","like","accept","grayThreshold","fontLib","convertImageData","data","arr","i","length","push","detect","imageData","this","rect","forEach","v","y","Math","floor","x","undefined","XStart","XEnd","YStart","YEnd","XOffset","YOffset","Y","X","adjustGrid","offset","toFixed","half","generateGridData","step","gridData","px","xx","yy","percent","filter","p","compareArray","b","matched","abs","validPoint","parseFloat","combineArray","setSize","cvs","style","clearCanvas","getContext","clearRect","getGridArea","ctx","getImageData","addFont","str","font","_canvas","document","createElement","textAlign","fillText","imgData","putImageData","img","toDataURL","fixFont","fontLibItem","drawGridData","_ref","compare","index","fillRect","13","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign___default","__WEBPACK_IMPORTED_MODULE_1__util__","__WEBPACK_IMPORTED_MODULE_1__util___default","name","drawing","steps","lib","showResult","mounted","_this","String","fromCharCode","$nextTick","$refs","methods","mousemove","e","beginPath","touches","offsetX","pageX","offsetY","pageY","arc","PI","fill","drawingEnable","drawingDisable","pick","reset","preview","drawUserGridData","runStep","autosave","step1","strokeRect","step2","_detect","moveTo","lineTo","lineWidth","stroke","_i","step3","step4","_this2","acc","sort","42","44","render","_vm","_h","$createElement","_c","_self","attrs","id","ref","on","touchmove","mousedown","touchstart","mouseup","touchend","mouseleave","_v","staticClass","_l","s","class","active","_s","r","click","$event","mouseenter","src","alt","_e","staticRenderFns","9","Component"],"mappings":"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","file":"static/js/app.6c433207d8d214e67c72.js","sourcesContent":["webpackJsonp([1],{\n\n/***/ 11:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_vue__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ocr__ = __webpack_require__(9);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ocr___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__ocr__);\n\n\n\n\n__WEBPACK_IMPORTED_MODULE_0_vue__[\"a\" /* default */].config.productionTip = false;\n\nnew __WEBPACK_IMPORTED_MODULE_0_vue__[\"a\" /* default */]({\n  el: '#app',\n  template: '<div><ocr/></div>',\n  components: { ocr: __WEBPACK_IMPORTED_MODULE_1__ocr___default.a }\n});\n\n/***/ }),\n\n/***/ 12:\n/***/ (function(module, exports) {\n\nvar config = {\n  pen: {\n    size: 4,\n    fillStyle: '#000',\n    strokeStyle: '#f00'\n  },\n  canvas: {\n    width: 200,\n    height: 200,\n    size: 200\n  },\n  grid: 32,\n  like: 0.05,\n  accept: 0.5,\n  grayThreshold: 128\n};\n\nvar fontLib = [];\n\nexports.config = config;\nexports.fontLib = fontLib;\n\nexports.convertImageData = function (data) {\n  var arr = [];\n  for (var i = 0; i < data.length; i += 4) {\n    if (data[i + 3] === 0) {\n      arr.push(0);\n      continue;\n    }\n    if (data[i] + data[i + 1] + data[i + 2] > config.grayThreshold * 3) {\n      arr.push(0);\n    } else {\n      arr.push(1);\n    }\n  }\n  return arr;\n};\n\nexports.detect = function (imageData) {\n  var arr = this.convertImageData(imageData.data);\n  var rect = {};\n\n  arr.forEach(function (v, i) {\n    if (v) {\n      var y = Math.floor(i / config.canvas.width);\n      var x = Math.floor(i % config.canvas.width);\n\n      if (rect.XStart === undefined) {\n        rect.XStart = x;\n        rect.XEnd = x;\n        rect.YStart = y;\n        rect.YEnd = y;\n        return;\n      }\n\n      if (x < rect.XStart) {\n        rect.XStart = x;\n      }\n\n      if (x > rect.XEnd) {\n        rect.XEnd = x;\n      }\n\n      if (y < rect.YStart) {\n        rect.YStart = y;\n      }\n\n      if (y > rect.YEnd) {\n        rect.YEnd = y;\n      }\n    }\n  });\n\n  var XOffset = rect.XEnd - rect.XStart;\n  var YOffset = rect.YEnd - rect.YStart;\n\n  if (YOffset >= XOffset) {\n    rect.Y = rect.YStart;\n    rect.X = Math.floor(rect.XStart - (YOffset - XOffset) / 2);\n    rect.size = YOffset;\n  }\n\n  if (YOffset < XOffset) {\n    rect.X = rect.XStart;\n    rect.Y = Math.floor(rect.YStart - (XOffset - YOffset) / 2);\n    rect.size = XOffset;\n  }\n\n  return rect;\n};\n\nexports.adjustGrid = function (rect) {\n  var offset = rect.size % config.grid;\n  if (offset === 0) {\n    return rect;\n  }\n\n  var toFixed = config.grid - offset;\n  var half = Math.floor(toFixed / 2);\n\n  return {\n    X: rect.X - half,\n    Y: rect.Y - half,\n    size: rect.size + toFixed\n  };\n};\n\nexports.generateGridData = function (data, size) {\n  var arr = this.convertImageData(data);\n  var grid = config.grid;\n  var step = size / grid;\n  var gridData = [];\n  for (var x = 0; x < grid; x++) {\n    for (var y = 0; y < grid; y++) {\n      var px = [];\n      for (var xx = 0; xx < step; xx++) {\n        for (var yy = 0; yy < step; yy++) {\n          px.push(arr[y * step + x * size * step + yy + xx * size]);\n        }\n      }\n      var percent = px.filter(function (p) {\n        return !!p;\n      }).length / px.length;\n      gridData[y + x * grid] = percent > config.accept ? percent : 0;\n    }\n  }\n  return gridData;\n};\n\nexports.compareArray = function (a, b) {\n  var matched = 0;\n  a.forEach(function (v, i) {\n    if (v === 0 && b[i] === 0) {\n      return;\n    }\n    if (Math.abs(v - b[i]) < config.like) {\n      matched++;\n    }\n  });\n  var validPoint = a.filter(function (v) {\n    return v > 0;\n  }).length + b.filter(function (v) {\n    return v > 0;\n  }).length;\n  return parseFloat(matched / validPoint).toFixed(4);\n};\n\nexports.combineArray = function (a, b) {\n  var arr = [];\n  a.forEach(function (v, i) {\n    arr.push((v + b[i]) / 2);\n  });\n  return arr;\n};\n\nexports.setSize = function (cvs, size) {\n  cvs.width = size;\n  cvs.height = size;\n  cvs.style.width = size + 'px';\n  cvs.style.height = size + 'px';\n};\n\nexports.clearCanvas = function (cvs) {\n  cvs.getContext('2d').clearRect(0, 0, cvs.width, cvs.height);\n};\n\nexports.getGridArea = function (cvs) {\n  var ctx = cvs.getContext('2d');\n  return this.adjustGrid(this.detect(ctx.getImageData(0, 0, cvs.width, cvs.height)));\n};\n\nexports.addFont = function (str, font) {\n  if (this._canvas === undefined) {\n    this._canvas = document.createElement('canvas');\n  }\n  var cvs = this._canvas;\n  this.setSize(cvs, config.canvas.size);\n  var ctx = cvs.getContext('2d');\n\n  ctx.clearRect(0, 0, config.canvas.size, config.canvas.size);\n  ctx.font = '200 ' + cvs.height / 2 + 'px ' + font;\n  ctx.textAlign = 'center';\n  ctx.fillStyle = '#000';\n  ctx.fillText(str, cvs.width / 2, cvs.height / 2);\n\n  var rect = this.getGridArea(cvs);\n  var imgData = ctx.getImageData(rect.X, rect.Y, rect.size, rect.size);\n  var data = this.generateGridData(imgData.data, rect.size);\n\n  this.setSize(cvs, rect.size);\n  ctx.putImageData(imgData, 0, 0);\n\n  fontLib.push({\n    value: str,\n    data: data,\n    img: cvs.toDataURL(),\n    size: rect.size\n  });\n};\n\nexports.fixFont = function (fontLibItem, gridData) {\n  fontLibItem.data = this.combineArray(fontLibItem.data, gridData);\n  this.setSize(this._canvas, fontLibItem.size);\n  this.clearCanvas(this._canvas);\n  this.drawGridData({\n    cvs: this._canvas,\n    gridData: fontLibItem.data,\n    rect: {\n      X: 0,\n      Y: 0,\n      size: fontLibItem.size\n    },\n    fillStyle: function fillStyle(v) {\n      return 'rgba(0, 0, 0, ' + v + ')';\n    }\n  });\n  fontLibItem.img = this._canvas.toDataURL();\n};\n\nexports.drawGridData = function (_ref) {\n  var cvs = _ref.cvs,\n      gridData = _ref.gridData,\n      rect = _ref.rect,\n      fillStyle = _ref.fillStyle,\n      compare = _ref.compare;\n\n  var ctx = cvs.getContext('2d');\n  var step = rect.size / config.grid;\n  for (var y = 0; y < config.grid; y++) {\n    for (var x = 0; x < config.grid; x++) {\n      var index = x + y * config.grid;\n      if (compare) {\n        ctx.fillStyle = fillStyle(gridData[index], compare[index]);\n      } else {\n        ctx.fillStyle = fillStyle(gridData[index]);\n      }\n      ctx.fillRect(rect.X + x * step, rect.Y + y * step, step, step);\n    }\n  }\n};\n\n/***/ }),\n\n/***/ 13:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign__ = __webpack_require__(14);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util__ = __webpack_require__(12);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__util__);\n\n\n\n\nvar config = __WEBPACK_IMPORTED_MODULE_1__util___default.a.config;\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  name: 'ocr',\n  data: function data() {\n    return {\n      drawing: false,\n      steps: ['draw text', 'detect text area', 'adjust grid', 'split', 'compare'],\n      step: 0,\n      detect: {},\n      lib: __WEBPACK_IMPORTED_MODULE_1__util___default.a.fontLib,\n      showResult: false\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    for (var i = 48; i < 91; i++) {\n      if (i > 57 && i < 65) {\n        continue;\n      }\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.addFont(String.fromCharCode(i), 'sans-serif');\n    }\n\n    this.$nextTick(function () {\n      __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign___default()(_this.$refs.cvs, config.canvas);\n      _this.$refs.cvs.style.width = config.canvas.width + 'px';\n      _this.$refs.cvs.style.height = config.canvas.height + 'px';\n      _this.ctx = _this.$refs.cvs.getContext('2d');\n    });\n  },\n\n  methods: {\n    mousemove: function mousemove(e) {\n      if (this.drawing) {\n        this.ctx.beginPath();\n        if (e.touches && e.touches[0]) {\n          e.offsetX = e.touches[0].pageX;\n          e.offsetY = e.touches[0].pageY;\n        }\n        this.ctx.arc(e.offsetX, e.offsetY, config.pen.size, 0, Math.PI * 2);\n        this.ctx.fillStyle = config.pen.fillStyle;\n        this.ctx.fill();\n      }\n    },\n    drawingEnable: function drawingEnable() {\n      this.drawing = true;\n    },\n    drawingDisable: function drawingDisable() {\n      this.drawing = false;\n    },\n    pick: function pick(v) {\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.fixFont(v, this.gridData);\n      this.reset();\n    },\n    preview: function preview(v) {\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.clearCanvas(this.$refs.cvs);\n      this.drawUserGridData();\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.drawGridData({\n        cvs: this.$refs.cvs,\n        gridData: v.data,\n        rect: this.detect,\n        compare: this.gridData,\n        fillStyle: function fillStyle(a, b) {\n          return b > 0 ? 'rgba(0, 255, 0, ' + (a === 0 ? 0 : 1 - Math.abs(a - b)) + ')' : 'rgba(255, 0, 0, ' + a + ')';\n        }\n      });\n    },\n    drawUserGridData: function drawUserGridData() {\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.drawGridData({\n        cvs: this.$refs.cvs,\n        gridData: this.gridData,\n        rect: this.detect,\n        fillStyle: function fillStyle(v) {\n          return 'rgba(0, 0, 0, ' + v + ')';\n        }\n      });\n    },\n    reset: function reset() {\n      this.step = 0;\n      this.showResult = false;\n      this.ctx.clearRect(0, 0, config.canvas.width, config.canvas.height);\n    },\n    runStep: function runStep() {\n      if (this.autosave === undefined) {\n        this.autosave = {};\n      }\n\n      if (this.step < this.steps.length - 1) {\n        this.autosave[this.step] = this.ctx.getImageData(0, 0, config.canvas.width, config.canvas.height);\n        this['step' + String(++this.step)]();\n      }\n    },\n    step1: function step1() {\n      var imgData = this.ctx.getImageData(0, 0, config.canvas.width, config.canvas.height);\n      this.detect = __WEBPACK_IMPORTED_MODULE_1__util___default.a.detect(imgData);\n\n      this.ctx.strokeStyle = config.pen.strokeStyle;\n      this.ctx.strokeRect(this.detect.X, this.detect.Y, this.detect.size, this.detect.size);\n    },\n    step2: function step2() {\n      this.ctx.putImageData(this.autosave[0], 0, 0);\n      this.detect = __WEBPACK_IMPORTED_MODULE_1__util___default.a.adjustGrid(this.detect);\n      this.ctx.strokeRect(this.detect.X, this.detect.Y, this.detect.size, this.detect.size);\n\n      var _detect = this.detect,\n          X = _detect.X,\n          Y = _detect.Y,\n          size = _detect.size;\n\n      var step = size / config.grid;\n\n      for (var i = Y; i < Y + size; i += step) {\n        this.ctx.beginPath();\n        this.ctx.moveTo(X, i);\n        this.ctx.lineTo(X + size, i);\n        this.ctx.lineWidth = 1;\n        this.ctx.stroke();\n      }\n\n      for (var _i = X; _i < X + size; _i += step) {\n        this.ctx.beginPath();\n        this.ctx.moveTo(_i, Y);\n        this.ctx.lineTo(_i, Y + size);\n        this.ctx.lineWidth = 1;\n        this.ctx.stroke();\n      }\n    },\n    step3: function step3() {\n      this.ctx.putImageData(this.autosave[0], 0, 0);\n      this.gridData = __WEBPACK_IMPORTED_MODULE_1__util___default.a.generateGridData(this.ctx.getImageData(this.detect.X, this.detect.Y, this.detect.size, this.detect.size).data, this.detect.size);\n      __WEBPACK_IMPORTED_MODULE_1__util___default.a.clearCanvas(this.$refs.cvs);\n      this.drawUserGridData();\n    },\n    step4: function step4() {\n      var _this2 = this;\n\n      this.lib.forEach(function (v) {\n        v.acc = __WEBPACK_IMPORTED_MODULE_1__util___default.a.compareArray(_this2.gridData, v.data);\n      });\n      this.lib.sort(function (a, b) {\n        return b.acc - a.acc;\n      });\n      this.showResult = true;\n\n      this.preview(this.lib[0]);\n    }\n  }\n});\n\n/***/ }),\n\n/***/ 42:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 44:\n/***/ (function(module, exports) {\n\nmodule.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    attrs: {\n      \"id\": \"ocr\"\n    }\n  }, [_c('canvas', {\n    ref: \"cvs\",\n    on: {\n      \"mousemove\": _vm.mousemove,\n      \"touchmove\": _vm.mousemove,\n      \"mousedown\": _vm.drawingEnable,\n      \"touchstart\": _vm.drawingEnable,\n      \"mouseup\": _vm.drawingDisable,\n      \"touchend\": _vm.drawingDisable,\n      \"mouseleave\": _vm.drawingDisable\n    }\n  }), _vm._v(\" \"), _c('div', {\n    staticClass: \"desc\"\n  }, [_c('h5', [_vm._v(\"STEPS\")]), _vm._v(\" \"), _c('ol', _vm._l((_vm.steps), function(s, index) {\n    return _c('li', {\n      class: {\n        active: index <= _vm.step\n      }\n    }, [_vm._v(_vm._s(s))])\n  })), _vm._v(\" \"), (_vm.showResult) ? _c('ul', {\n    staticClass: \"result\"\n  }, _vm._l((_vm.lib), function(r) {\n    return _c('li', {\n      on: {\n        \"click\": function($event) {\n          _vm.pick(r)\n        },\n        \"mouseenter\": function($event) {\n          _vm.preview(r)\n        }\n      }\n    }, [_c('img', {\n      attrs: {\n        \"src\": r.img,\n        \"alt\": r.value\n      }\n    }), _vm._v(\" \"), _c('span', [_vm._v(_vm._s(r.acc))]), _vm._v(\" \"), _c('img', {\n      staticClass: \"preview\",\n      attrs: {\n        \"src\": r.img,\n        \"alt\": r.value\n      }\n    })])\n  })) : _vm._e()]), _vm._v(\" \"), (this.step < this.steps.length - 1) ? _c('button', {\n    on: {\n      \"click\": _vm.runStep\n    }\n  }, [_vm._v(\"next step\")]) : _vm._e()])\n},staticRenderFns: []}\n\n/***/ }),\n\n/***/ 9:\n/***/ (function(module, exports, __webpack_require__) {\n\n\n/* styles */\n__webpack_require__(42)\n\nvar Component = __webpack_require__(43)(\n  /* script */\n  __webpack_require__(13),\n  /* template */\n  __webpack_require__(44),\n  /* scopeId */\n  null,\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n/***/ })\n\n},[11]);\n\n\n// WEBPACK FOOTER //\n// static/js/app.6c433207d8d214e67c72.js","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport ocr from './ocr'\n\nVue.config.productionTip = false\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  template: '<div><ocr/></div>',\n  components: { ocr }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","const config = {\n  pen: {\n    size: 4,\n    fillStyle: '#000',\n    strokeStyle: '#f00'\n  },\n  canvas: {\n    width: 200,\n    height: 200,\n    size: 200\n  },\n  grid: 32,\n  like: 0.05,\n  accept: 0.5,\n  grayThreshold: 128\n}\n\nconst fontLib = []\n\nexports.config = config\nexports.fontLib = fontLib\n\n/**\n * grid data\n * @typedef {Array} GridData\n *\n */\n\nexports.convertImageData = function (data) {\n  const arr = []\n  for (let i = 0; i < data.length; i += 4) {\n    if (data[i + 3] === 0) {\n      arr.push(0)\n      continue\n    }\n    if ((data[i] + data[i + 1] + data[i + 2]) > config.grayThreshold * 3) {\n      arr.push(0)\n    } else {\n      arr.push(1)\n    }\n  }\n  return arr\n}\n\nexports.detect = function (imageData) {\n  const arr = this.convertImageData(imageData.data)\n  const rect = {}\n\n  arr.forEach((v, i) => {\n    if (v) {\n      const y = Math.floor(i / config.canvas.width)\n      const x = Math.floor(i % config.canvas.width)\n\n      if (rect.XStart === undefined) {\n        rect.XStart = x\n        rect.XEnd = x\n        rect.YStart = y\n        rect.YEnd = y\n        return\n      }\n\n      if (x < rect.XStart) {\n        rect.XStart = x\n      }\n\n      if (x > rect.XEnd) {\n        rect.XEnd = x\n      }\n\n      if (y < rect.YStart) {\n        rect.YStart = y\n      }\n\n      if (y > rect.YEnd) {\n        rect.YEnd = y\n      }\n    }\n  })\n\n  const XOffset = rect.XEnd - rect.XStart\n  const YOffset = rect.YEnd - rect.YStart\n\n  if (YOffset >= XOffset) {\n    rect.Y = rect.YStart\n    rect.X = Math.floor(rect.XStart - (YOffset - XOffset) / 2)\n    rect.size = YOffset\n  }\n\n  if (YOffset < XOffset) {\n    rect.X = rect.XStart\n    rect.Y = Math.floor(rect.YStart - (XOffset - YOffset) / 2)\n    rect.size = XOffset\n  }\n\n  return rect\n}\n\nexports.adjustGrid = function (rect) {\n  const offset = rect.size % config.grid\n  if (offset === 0) {\n    return rect\n  }\n\n  const toFixed = config.grid - offset\n  const half = Math.floor(toFixed / 2)\n\n  return {\n    X: rect.X - half,\n    Y: rect.Y - half,\n    size: rect.size + toFixed\n  }\n}\n\nexports.generateGridData = function (data, size) {\n  const arr = this.convertImageData(data)\n  const grid = config.grid\n  const step = size / grid\n  const gridData = []\n  for (let x = 0; x < grid; x++) {\n    for (let y = 0; y < grid; y++) {\n      const px = []\n      for (let xx = 0; xx < step; xx++) {\n        for (let yy = 0; yy < step; yy++) {\n          px.push(arr[y * step + x * size * step + yy + xx * size])\n        }\n      }\n      const percent = px.filter(p => !!p).length / px.length\n      gridData[y + x * grid] = percent > config.accept ? percent : 0\n    }\n  }\n  return gridData\n}\n\nexports.compareArray = function (a, b) {\n  let matched = 0\n  a.forEach((v, i) => {\n    if (v === 0 && b[i] === 0) {\n      return\n    }\n    if (Math.abs(v - b[i]) < config.like) {\n      matched++\n    }\n  })\n  const validPoint = a.filter(v => v > 0).length + b.filter(v => v > 0).length\n  return parseFloat(matched / validPoint).toFixed(4)\n}\n\nexports.combineArray = function (a, b) {\n  const arr = []\n  a.forEach((v, i) => {\n    arr.push((v + b[i]) / 2)\n  })\n  return arr\n}\n\n/**\n * set canvas size\n * @param {Element} cvs\n * @param {Number} size\n */\nexports.setSize = function (cvs, size) {\n  cvs.width = size\n  cvs.height = size\n  cvs.style.width = size + 'px'\n  cvs.style.height = size + 'px'\n}\n\nexports.clearCanvas = function (cvs) {\n  cvs.getContext('2d').clearRect(0, 0, cvs.width, cvs.height)\n}\n\n/**\n * get grid area from canvas\n * @param {Element} cvs\n * @return {{X, Y, size}}\n */\nexports.getGridArea = function (cvs) {\n  const ctx = cvs.getContext('2d')\n  return this.adjustGrid(this.detect(ctx.getImageData(0, 0, cvs.width, cvs.height)))\n}\n\n/**\n * add font to fontLib\n * @param {String|Number} str\n * @param {Object} fontStyle\n */\nexports.addFont = function (str, font) {\n  if (this._canvas === undefined) {\n    this._canvas = document.createElement('canvas')\n  }\n  const cvs = this._canvas\n  this.setSize(cvs, config.canvas.size)\n  const ctx = cvs.getContext('2d')\n\n  ctx.clearRect(0, 0, config.canvas.size, config.canvas.size)\n  ctx.font = `200 ${cvs.height / 2}px ${font}`\n  ctx.textAlign = 'center'\n  ctx.fillStyle = '#000'\n  ctx.fillText(str, cvs.width / 2, cvs.height / 2)\n\n  const rect = this.getGridArea(cvs)\n  const imgData = ctx.getImageData(rect.X, rect.Y, rect.size, rect.size)\n  const data = this.generateGridData(imgData.data, rect.size)\n\n  this.setSize(cvs, rect.size)\n  ctx.putImageData(imgData, 0, 0)\n\n  fontLib.push({\n    value: str,\n    data,\n    img: cvs.toDataURL(),\n    size: rect.size\n  })\n}\n\nexports.fixFont = function (fontLibItem, gridData) {\n  fontLibItem.data = this.combineArray(fontLibItem.data, gridData)\n  this.setSize(this._canvas, fontLibItem.size)\n  this.clearCanvas(this._canvas)\n  this.drawGridData({\n    cvs: this._canvas,\n    gridData: fontLibItem.data,\n    rect: {\n      X: 0,\n      Y: 0,\n      size: fontLibItem.size\n    },\n    fillStyle: v => `rgba(0, 0, 0, ${v})`\n  })\n  fontLibItem.img = this._canvas.toDataURL()\n}\n\n/**\n * drawGridData\n * @param {Element} cvs\n * @param {GridData} gridData\n * @param {{X, Y, size}} rect\n */\nexports.drawGridData = function ({ cvs, gridData, rect, fillStyle, compare }) {\n  const ctx = cvs.getContext('2d')\n  const step = rect.size / config.grid\n  for (let y = 0; y < config.grid; y++) {\n    for (let x = 0; x < config.grid; x++) {\n      const index = x + y * config.grid\n      if (compare) {\n        ctx.fillStyle = fillStyle(gridData[index], compare[index])\n      } else {\n        ctx.fillStyle = fillStyle(gridData[index])\n      }\n      ctx.fillRect(rect.X + x * step, rect.Y + y * step, step, step)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js","<template>\n  <div id=\"ocr\">\n    <canvas ref=\"cvs\"\n      @mousemove=\"mousemove\"\n      @touchmove=\"mousemove\"\n      @mousedown=\"drawingEnable\"\n      @touchstart=\"drawingEnable\"\n      @mouseup=\"drawingDisable\"\n      @touchend=\"drawingDisable\"\n      @mouseleave=\"drawingDisable\">\n    </canvas>\n    <div class=\"desc\">\n      <h5>STEPS</h5>\n      <ol>\n        <li v-for=\"(s, index) in steps\" :class=\"{ active: index <= step }\">{{s}}</li>\n      </ol>\n      <ul v-if=\"showResult\" class=\"result\">\n        <li v-for=\"r in lib\" @click=\"pick(r)\" @mouseenter=\"preview(r)\">\n          <img :src=\"r.img\" :alt=\"r.value\">\n          <span>{{r.acc}}</span>\n          <img class=\"preview\" :src=\"r.img\" :alt=\"r.value\">\n        </li>\n      </ul>\n    </div>\n    <button @click=\"runStep\" v-if=\"this.step < this.steps.length - 1\">next step</button>\n  </div>\n</template>\n\n<script>\nimport util from './util'\nconst config = util.config\n\nexport default {\n  name: 'ocr',\n  data () {\n    return {\n      drawing: false,\n      steps: ['draw text', 'detect text area', 'adjust grid', 'split', 'compare'],\n      step: 0,\n      detect: {},\n      lib: util.fontLib,\n      showResult: false\n    }\n  },\n  mounted () {\n    for (let i = 48; i < 91; i++) {\n      if (i > 57 && i < 65) {\n        continue\n      }\n      util.addFont(String.fromCharCode(i), `sans-serif`)\n    }\n\n    this.$nextTick(() => {\n      Object.assign(this.$refs.cvs, config.canvas)\n      this.$refs.cvs.style.width = config.canvas.width + 'px'\n      this.$refs.cvs.style.height = config.canvas.height + 'px'\n      this.ctx = this.$refs.cvs.getContext('2d')\n    })\n  },\n  methods: {\n    mousemove (e) {\n      if (this.drawing) {\n        this.ctx.beginPath()\n        if (e.touches && e.touches[0]) {\n          e.offsetX = e.touches[0].pageX\n          e.offsetY = e.touches[0].pageY\n        }\n        this.ctx.arc(e.offsetX, e.offsetY, config.pen.size, 0, Math.PI * 2)\n        this.ctx.fillStyle = config.pen.fillStyle\n        this.ctx.fill()\n      }\n    },\n    drawingEnable () {\n      this.drawing = true\n    },\n    drawingDisable () {\n      this.drawing = false\n    },\n    pick (v) {\n      util.fixFont(v, this.gridData)\n      this.reset()\n    },\n    preview (v) {\n      util.clearCanvas(this.$refs.cvs)\n      this.drawUserGridData()\n      util.drawGridData({\n        cvs: this.$refs.cvs,\n        gridData: v.data,\n        rect: this.detect,\n        compare: this.gridData,\n        fillStyle: (a, b) => b > 0 ? `rgba(0, 255, 0, ${a === 0 ? 0 : 1 - Math.abs(a - b)})` : `rgba(255, 0, 0, ${a})`\n      })\n    },\n    drawUserGridData () {\n      util.drawGridData({\n        cvs: this.$refs.cvs,\n        gridData: this.gridData,\n        rect: this.detect,\n        fillStyle: v => `rgba(0, 0, 0, ${v})`\n      })\n    },\n    reset () {\n      this.step = 0\n      this.showResult = false\n      this.ctx.clearRect(0, 0, config.canvas.width, config.canvas.height)\n    },\n    runStep () {\n      if (this.autosave === undefined) {\n        this.autosave = {}\n      }\n\n      if (this.step < this.steps.length - 1) {\n        this.autosave[this.step] = this.ctx.getImageData(0, 0, config.canvas.width, config.canvas.height)\n        this['step' + String(++this.step)]()\n      }\n    },\n    step1 () {\n      const imgData = this.ctx.getImageData(0, 0, config.canvas.width, config.canvas.height)\n      this.detect = util.detect(imgData)\n\n      // draw detect area\n      this.ctx.strokeStyle = config.pen.strokeStyle\n      this.ctx.strokeRect(this.detect.X, this.detect.Y, this.detect.size, this.detect.size)\n    },\n    step2 () {\n      this.ctx.putImageData(this.autosave[0], 0, 0)\n      this.detect = util.adjustGrid(this.detect)\n      this.ctx.strokeRect(this.detect.X, this.detect.Y, this.detect.size, this.detect.size)\n\n      const { X, Y, size } = this.detect\n      const step = size / config.grid\n      // draw line on yAxis\n      for (let i = Y; i < Y + size; i += step) {\n        this.ctx.beginPath()\n        this.ctx.moveTo(X, i)\n        this.ctx.lineTo(X + size, i)\n        this.ctx.lineWidth = 1\n        this.ctx.stroke()\n      }\n      // draw line on xAxis\n      for (let i = X; i < X + size; i += step) {\n        this.ctx.beginPath()\n        this.ctx.moveTo(i, Y)\n        this.ctx.lineTo(i, Y + size)\n        this.ctx.lineWidth = 1\n        this.ctx.stroke()\n      }\n    },\n    step3 () {\n      this.ctx.putImageData(this.autosave[0], 0, 0)\n      this.gridData = util.generateGridData(this.ctx.getImageData(this.detect.X, this.detect.Y, this.detect.size, this.detect.size).data, this.detect.size)\n      util.clearCanvas(this.$refs.cvs)\n      this.drawUserGridData()\n    },\n    step4 () {\n      this.lib.forEach(v => {\n        v.acc = util.compareArray(this.gridData, v.data)\n      })\n      this.lib.sort((a, b) => b.acc - a.acc)\n      this.showResult = true\n\n      this.preview(this.lib[0])\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n  body, html {\n    margin: 0;\n    padding: 0;\n    font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;\n  }\n  #ocr {\n    // display: flex;\n  }\n  canvas {\n    border: 1px solid #ddd;\n  }\n  ol {\n    .active {\n      color: red;\n    }\n  }\n  h5 {\n    text-align: center;\n  }\n  .result {\n    margin: 0;\n    padding: 0;\n    list-style: none;\n    li {\n      position: relative;\n      height: 30px;\n      line-height: 30px;\n      display: inline-block;\n      img {\n        height: 100%;\n      }\n      &:hover {\n        background-color: #ddd;\n        .preview {\n          display: block;\n          position: absolute;\n          top: 0;\n          right: -200px;\n          height: 200px;\n        }\n      }\n      .preview {\n        display: none;\n      }\n    }\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// ocr.vue?0eb555c7","module.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    attrs: {\n      \"id\": \"ocr\"\n    }\n  }, [_c('canvas', {\n    ref: \"cvs\",\n    on: {\n      \"mousemove\": _vm.mousemove,\n      \"touchmove\": _vm.mousemove,\n      \"mousedown\": _vm.drawingEnable,\n      \"touchstart\": _vm.drawingEnable,\n      \"mouseup\": _vm.drawingDisable,\n      \"touchend\": _vm.drawingDisable,\n      \"mouseleave\": _vm.drawingDisable\n    }\n  }), _vm._v(\" \"), _c('div', {\n    staticClass: \"desc\"\n  }, [_c('h5', [_vm._v(\"STEPS\")]), _vm._v(\" \"), _c('ol', _vm._l((_vm.steps), function(s, index) {\n    return _c('li', {\n      class: {\n        active: index <= _vm.step\n      }\n    }, [_vm._v(_vm._s(s))])\n  })), _vm._v(\" \"), (_vm.showResult) ? _c('ul', {\n    staticClass: \"result\"\n  }, _vm._l((_vm.lib), function(r) {\n    return _c('li', {\n      on: {\n        \"click\": function($event) {\n          _vm.pick(r)\n        },\n        \"mouseenter\": function($event) {\n          _vm.preview(r)\n        }\n      }\n    }, [_c('img', {\n      attrs: {\n        \"src\": r.img,\n        \"alt\": r.value\n      }\n    }), _vm._v(\" \"), _c('span', [_vm._v(_vm._s(r.acc))]), _vm._v(\" \"), _c('img', {\n      staticClass: \"preview\",\n      attrs: {\n        \"src\": r.img,\n        \"alt\": r.value\n      }\n    })])\n  })) : _vm._e()]), _vm._v(\" \"), (this.step < this.steps.length - 1) ? _c('button', {\n    on: {\n      \"click\": _vm.runStep\n    }\n  }, [_vm._v(\"next step\")]) : _vm._e()])\n},staticRenderFns: []}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-loader/lib/template-compiler?{\"id\":\"data-v-5b7b0d64\"}!./~/vue-loader/lib/selector.js?type=template&index=0!./src/ocr.vue\n// module id = 44\n// module chunks = 1","\n/* styles */\nrequire(\"!!../node_modules/extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":true,\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"id\\\":\\\"data-v-5b7b0d64\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./ocr.vue\")\n\nvar Component = require(\"!../node_modules/vue-loader/lib/component-normalizer\")(\n  /* script */\n  require(\"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./ocr.vue\"),\n  /* template */\n  require(\"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5b7b0d64\\\"}!../node_modules/vue-loader/lib/selector?type=template&index=0!./ocr.vue\"),\n  /* scopeId */\n  null,\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/ocr.vue\n// module id = 9\n// module chunks = 1"],"sourceRoot":""}