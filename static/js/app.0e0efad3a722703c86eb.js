webpackJsonp([1],{11:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(10),s=i(9),r=i.n(s);a.a.config.productionTip=!1,new a.a({el:"#app",template:"<div><ocr/></div>",components:{ocr:r.a}})},12:function(t,e){var i={pen:{size:4,fillStyle:"#000",strokeStyle:"#f00"},canvas:{width:200,height:200,size:200},grid:32,like:.05,accept:.5,grayThreshold:128},a=[];e.config=i,e.fontLib=a,e.convertImageData=function(t){for(var e=[],a=0;a<t.length;a+=4)0!==t[a+3]?t[a]+t[a+1]+t[a+2]>3*i.grayThreshold?e.push(0):e.push(1):e.push(0);return e},e.detect=function(t){var e=this.convertImageData(t.data),a={};e.forEach(function(t,e){if(t){var s=Math.floor(e/i.canvas.width),r=Math.floor(e%i.canvas.width);if(void 0===a.XStart)return a.XStart=r,a.XEnd=r,a.YStart=s,void(a.YEnd=s);r<a.XStart&&(a.XStart=r),r>a.XEnd&&(a.XEnd=r),s<a.YStart&&(a.YStart=s),s>a.YEnd&&(a.YEnd=s)}});var s=a.XEnd-a.XStart,r=a.YEnd-a.YStart;return r>=s&&(a.Y=a.YStart,a.X=Math.floor(a.XStart-(r-s)/2),a.size=r),r<s&&(a.X=a.XStart,a.Y=Math.floor(a.YStart-(s-r)/2),a.size=s),a},e.adjustGrid=function(t){var e=t.size%i.grid;if(0===e)return t;var a=i.grid-e,s=Math.floor(a/2);return{X:t.X-s,Y:t.Y-s,size:t.size+a}},e.generateGridData=function(t,e){for(var a=this.convertImageData(t),s=i.grid,r=e/s,n=[],c=0;c<s;c++)for(var h=0;h<s;h++){for(var o=[],d=0;d<r;d++)for(var u=0;u<r;u++)o.push(a[h*r+c*e*r+u+d*e]);var l=o.filter(function(t){return!!t}).length/o.length;n[h+c*s]=l>i.accept?l:0}return n},e.compareArray=function(t,e){var a=0;t.forEach(function(t,s){0===t&&0===e[s]||Math.abs(t-e[s])<i.like&&a++});var s=t.filter(function(t){return t>0}).length+e.filter(function(t){return t>0}).length;return parseFloat(a/s).toFixed(4)},e.combineArray=function(t,e){var i=[];return t.forEach(function(t,a){i.push((t+e[a])/2)}),i},e.setSize=function(t,e){t.width=e,t.height=e,t.style.width=e+"px",t.style.height=e+"px"},e.clearCanvas=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},e.getGridArea=function(t){var e=t.getContext("2d");return this.adjustGrid(this.detect(e.getImageData(0,0,t.width,t.height)))},e.addFont=function(t,e){void 0===this._canvas&&(this._canvas=document.createElement("canvas"));var s=this._canvas;this.setSize(s,i.canvas.size);var r=s.getContext("2d");r.clearRect(0,0,i.canvas.size,i.canvas.size),r.font="200 "+s.height/2+"px "+e,r.textAlign="center",r.fillStyle="#000",r.fillText(t,s.width/2,s.height/2);var n=this.getGridArea(s),c=r.getImageData(n.X,n.Y,n.size,n.size),h=this.generateGridData(c.data,n.size);this.setSize(s,n.size),r.putImageData(c,0,0),a.push({value:t,data:h,img:s.toDataURL(),size:n.size})},e.fixFont=function(t,e){t.data=this.combineArray(t.data,e),this.setSize(this._canvas,t.size),this.clearCanvas(this._canvas),this.drawGridData({cvs:this._canvas,gridData:t.data,rect:{X:0,Y:0,size:t.size},fillStyle:function(t){return"rgba(0, 0, 0, "+t+")"}}),t.img=this._canvas.toDataURL()},e.drawGridData=function(t){for(var e=t.cvs,a=t.gridData,s=t.rect,r=t.fillStyle,n=t.compare,c=e.getContext("2d"),h=s.size/i.grid,o=0;o<i.grid;o++)for(var d=0;d<i.grid;d++){var u=d+o*i.grid;c.fillStyle=n?r(a[u],n[u]):r(a[u]),c.fillRect(s.X+d*h,s.Y+o*h,h,h)}}},13:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(14),s=i.n(a),r=i(12),n=i.n(r),c=n.a.config;e.default={name:"ocr",data:function(){return{drawing:!1,steps:["draw text","detect text area","adjust grid","split","compare"],step:0,detect:{},lib:n.a.fontLib,showResult:!1}},mounted:function(){for(var t=this,e=48;e<91;e++)e>57&&e<65||n.a.addFont(String.fromCharCode(e),"sans-serif");this.$nextTick(function(){s()(t.$refs.cvs,c.canvas),t.$refs.cvs.style.width=c.canvas.width+"px",t.$refs.cvs.style.height=c.canvas.height+"px",t.ctx=t.$refs.cvs.getContext("2d")})},methods:{mousemove:function(t){this.drawing&&(this.ctx.beginPath(),this.ctx.arc(t.offsetX,t.offsetY,c.pen.size,0,2*Math.PI),this.ctx.fillStyle=c.pen.fillStyle,this.ctx.fill())},drawingEnable:function(){this.drawing=!0},drawingDisable:function(){this.drawing=!1},pick:function(t){n.a.fixFont(t,this.gridData),this.reset()},preview:function(t){n.a.clearCanvas(this.$refs.cvs),this.drawUserGridData(),n.a.drawGridData({cvs:this.$refs.cvs,gridData:t.data,rect:this.detect,compare:this.gridData,fillStyle:function(t,e){return e>0?"rgba(0, 255, 0, "+(0===t?0:1-Math.abs(t-e))+")":"rgba(255, 0, 0, "+t+")"}})},drawUserGridData:function(){n.a.drawGridData({cvs:this.$refs.cvs,gridData:this.gridData,rect:this.detect,fillStyle:function(t){return"rgba(0, 0, 0, "+t+")"}})},reset:function(){this.step=0,this.showResult=!1,this.ctx.clearRect(0,0,c.canvas.width,c.canvas.height)},runStep:function(){void 0===this.autosave&&(this.autosave={}),this.step<this.steps.length-1&&(this.autosave[this.step]=this.ctx.getImageData(0,0,c.canvas.width,c.canvas.height),this["step"+String(++this.step)]())},step1:function(){var t=this.ctx.getImageData(0,0,c.canvas.width,c.canvas.height);this.detect=n.a.detect(t),this.ctx.strokeStyle=c.pen.strokeStyle,this.ctx.strokeRect(this.detect.X,this.detect.Y,this.detect.size,this.detect.size)},step2:function(){this.ctx.putImageData(this.autosave[0],0,0),this.detect=n.a.adjustGrid(this.detect),this.ctx.strokeRect(this.detect.X,this.detect.Y,this.detect.size,this.detect.size);for(var t=this.detect,e=t.X,i=t.Y,a=t.size,s=a/c.grid,r=i;r<i+a;r+=s)this.ctx.beginPath(),this.ctx.moveTo(e,r),this.ctx.lineTo(e+a,r),this.ctx.lineWidth=1,this.ctx.stroke();for(var h=e;h<e+a;h+=s)this.ctx.beginPath(),this.ctx.moveTo(h,i),this.ctx.lineTo(h,i+a),this.ctx.lineWidth=1,this.ctx.stroke()},step3:function(){this.ctx.putImageData(this.autosave[0],0,0),this.gridData=n.a.generateGridData(this.ctx.getImageData(this.detect.X,this.detect.Y,this.detect.size,this.detect.size).data,this.detect.size),n.a.clearCanvas(this.$refs.cvs),this.drawUserGridData()},step4:function(){var t=this;this.lib.forEach(function(e){e.acc=n.a.compareArray(t.gridData,e.data)}),this.lib.sort(function(t,e){return e.acc-t.acc}),this.showResult=!0,this.preview(this.lib[0])}}}},42:function(t,e){},44:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"ocr"}},[i("canvas",{ref:"cvs",on:{mousemove:t.mousemove,touchmove:t.mousemove,mousedown:t.drawingEnable,mouseup:t.drawingDisable,mouseleave:t.drawingDisable}}),t._v(" "),i("div",{staticClass:"desc"},[i("h5",[t._v("STEPS")]),t._v(" "),i("ol",t._l(t.steps,function(e,a){return i("li",{class:{active:a<=t.step}},[t._v(t._s(e))])})),t._v(" "),t.showResult?i("ul",{staticClass:"result"},t._l(t.lib,function(e){return i("li",{on:{click:function(i){t.pick(e)},mouseenter:function(i){t.preview(e)}}},[i("img",{attrs:{src:e.img,alt:e.value}}),t._v(" "),i("span",[t._v(t._s(e.acc))]),t._v(" "),i("img",{staticClass:"preview",attrs:{src:e.img,alt:e.value}})])})):t._e()]),t._v(" "),this.step<this.steps.length-1?i("button",{on:{click:t.runStep}},[t._v("next step")]):t._e()])},staticRenderFns:[]}},9:function(t,e,i){i(42);var a=i(43)(i(13),i(44),null,null);t.exports=a.exports}},[11]);
//# sourceMappingURL=app.0e0efad3a722703c86eb.js.map