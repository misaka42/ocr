webpackJsonp([1],[,function(t,e){var i={pen:{size:10,fillStyle:"#000"},canvas:{width:200,height:200,size:window.innerWidth>400?400:window.innerWidth},grid:32,like:.1,accept:.6,grayThreshold:128},a=[],s={};e.config=i,e.fontLib=a,e.userDraw=s,e.convertImageData=function(t){for(var e=[],a=0;a<t.length;a+=4)0!==t[a+3]?t[a]+t[a+1]+t[a+2]>3*i.grayThreshold?e.push(0):e.push(1):e.push(0);return e},e.compareArray=function(t,e){var a=0;t.forEach(function(t,s){0===t&&0===e[s]||Math.abs(t-e[s])<i.like&&a++});var s=t.filter(function(t){return t>0}).length+e.filter(function(t){return t>0}).length;return parseFloat(a/s).toFixed(4)},e.combineArray=function(t,e,i){i=i||.5;var a=[];return t.forEach(function(t,s){a.push(t*(1-i)+e[s]*i)}),a},e.setSize=function(t,e){t.width=e*window.devicePixelRatio,t.height=e*window.devicePixelRatio,t.style.width=e+"px",t.style.height=e+"px"},e.clearCanvas=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},e.addFont=function(t,e){void 0===this._canvas&&(this._canvas=document.createElement("canvas"));var s=this._canvas;this.setSize(s,4*i.grid);var n=s.getContext("2d");this.clearCanvas(s),n.font="200 "+s.height/2+"px "+e,n.textAlign="center",n.fillStyle="#000",n.fillText(t,s.width/2,s.height/2);var r=this.getAdjustArea(s),c=this.getGridData(s,r);this.setSize(s,r.size),this.drawArea({cvs:s,data:c,area:{x:0,y:0,size:r.size*window.devicePixelRatio},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),a.push({value:t,data:c,img:s.toDataURL(),size:r.size})},e.addCustomFont=function(t){var e=this._canvas,n=s.data;this.setSize(e,i.canvas.size),this.clearCanvas(e),this.drawArea({cvs:e,data:n,area:{x:0,y:0,size:this._canvas.width},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),a.push({value:t,data:n,img:e.toDataURL(),size:i.canvas.size})},e.fixFont=function(t,e){t.data=this.combineArray(t.data,s.data,e),this.setSize(this._canvas,t.size),this.clearCanvas(this._canvas),this.drawArea({cvs:this._canvas,data:t.data,area:{x:0,y:0,size:this._canvas.width},style:function(t){return"rgba(0, 0, 0, "+t+")"}}),t.img=this._canvas.toDataURL()},e.drawArea=function(t){for(var e=t.cvs,a=t.data,s=t.area,n=t.style,r=t.compare,c=e.getContext("2d"),o=s.size/i.grid,h=0;h<i.grid;h++)for(var u=0;u<i.grid;u++){var d=u+h*i.grid;c.fillStyle=r?n(a[d],r[d]):n(a[d]),c.fillRect(s.x+u*o,s.x+h*o,o,o)}},e.drawAreaBorder=function(t){var e=t.cvs,i=t.area,a=t.style,s=e.getContext("2d");s.strokeStyle=a,s.lineWidth=1,s.strokeRect(i.x,i.y,i.size,i.size)},e.getDetectArea=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height),i=this.convertImageData(e.data),a={};i.forEach(function(e,i){if(e){var s=Math.floor(i/t.width),n=Math.floor(i%t.width);if(void 0===a.XStart)return a.XStart=n,a.XEnd=n,a.YStart=s,void(a.YEnd=s);n<a.XStart&&(a.XStart=n),n>a.XEnd&&(a.XEnd=n),s<a.YStart&&(a.YStart=s),s>a.YEnd&&(a.YEnd=s)}});var s=a.XEnd-a.XStart,n=a.YEnd-a.YStart;return n>=s&&(a.y=a.YStart,a.x=Math.floor(a.XStart-(n-s)/2),a.size=n),n<s&&(a.x=a.XStart,a.y=Math.floor(a.YStart-(s-n)/2),a.size=s),a},e.adjustArea=function(t){var e=t.size%i.grid;if(0===e)return t;var a=i.grid-e,s=Math.floor(a/2);return{x:t.x-s,y:t.y-s,size:t.size+a}},e.getAdjustArea=function(t){return this.adjustArea(this.getDetectArea(t))},e.getGridData=function(t,e){for(var a=t.getContext("2d").getImageData(e.x,e.y,e.size,e.size),s=this.convertImageData(a.data),n=e.size,r=i.grid,c=n/r,o=[],h=0;h<r;h++)for(var u=0;u<r;u++){for(var d=[],v=0;v<c;v++)for(var l=0;l<c;l++)d.push(s[u*c+h*n*c+l+v*n]);var f=d.filter(function(t){return!!t}).length/d.length;o[u+h*r]=f>i.accept?f:0}return o},e.initFontLib=function(){if(!a.length)for(var t=48;t<91;t++)t>57&&t<65||this.addFont(String.fromCharCode(t),"sans-serif")},e.findMatch=function(t){var e=this;return a.forEach(function(i){i.acc=e.compareArray(t,i.data)}),s.data=t,a.sort(function(t,e){return e.acc-t.acc}),a[0]}},,function(t,e,i){"use strict";var a=i(19),s=i.n(a),n=i(20),r=i.n(n),c=i(1),o=c.config,h=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.canvas.size,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];s()(this,t),void 0===e&&(e=document.createElement("canvas")),this.cvs=e,this.size=i,this.canDraw=a,this.callback={},this.init(e)}return r()(t,[{key:"init",value:function(t){c.setSize(t,this.size),this.canDraw&&(this.addEvent(["mousedown","touchstart"],this.drawStart),this.addEvent(["mouseup","mouseleave","mouseenter","touchend"],this.drawEnd),this.addEvent(["mousemove","touchmove"],this.drawing))}},{key:"addEvent",value:function(t,e){var i=this;t.forEach(function(t){i.cvs.addEventListener(t,function(t){e.call(i,t),t.preventDefault()})})}},{key:"drawing",value:function(t){this._line&&(clearTimeout(this._afterDraw),t.touches&&t.touches[0]&&(t.offsetX=t.touches[0].pageX,t.offsetY=t.touches[0].pageY),this._line.add(t.offsetX,t.offsetY))}},{key:"drawStart",value:function(){this.stashPop(),this._line=new u(this.cvs)}},{key:"drawEnd",value:function(){this._line=null,this._afterDraw=setTimeout(this.afterDraw.bind(this),600)}},{key:"afterDraw",value:function(){this.stash();var t=this.getAdjustDetectArea(),e=c.getGridData(this.cvs,t);this.callback.finish&&this.callback.finish(e),c.drawAreaBorder({cvs:this.cvs,area:t,style:"rgba(255, 0, 0, 0.5)"})}},{key:"stash",value:function(){this._snapshot=this.cvs.getContext("2d").getImageData(0,0,this.cvs.width,this.cvs.height)}},{key:"stashPop",value:function(){this._snapshot&&(this.cvs.getContext("2d").putImageData(this._snapshot,0,0),this._snapshot=null)}},{key:"clear",value:function(){this._snapshot=null,c.clearCanvas(this.cvs)}},{key:"getDetectArea",value:function(){return c.getDetectArea(this.cvs)}},{key:"getAdjustDetectArea",value:function(){return c.getAdjustArea(this.cvs)}}]),t}();e.a=h;var u=function(){function t(e){s()(this,t),this.cvs=e,this.ctx=e.getContext("2d"),this.ratio=window.devicePixelRatio}return r()(t,[{key:"add",value:function(t,e){t*=this.ratio,e*=this.ratio,this._last&&this.drawLine(this._last,{x:t,y:e}),this.drawArc(t,e),this._last={x:t,y:e}}},{key:"drawLine",value:function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.lineWidth=2*o.pen.size,this.ctx.strokeStyle=o.pen.fillStyle,this.ctx.stroke()}},{key:"drawArc",value:function(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,o.pen.size,0,2*Math.PI),this.ctx.fillStyle=o.pen.fillStyle,this.ctx.fill()}}]),t}()},,,,,,function(t,e){},function(t,e){},function(t,e,i){var a=i(8)(i(16),i(33),null,null);t.exports=a.exports},function(t,e,i){var a=i(8)(i(17),i(32),null,null);t.exports=a.exports},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(14),s=i(13),n=i(11),r=i.n(n),c=i(12),o=i.n(c),h=i(9),u=(i.n(h),i(10));i.n(u);a.a.config.productionTip=!1,a.a.use(s.a);var d=[{path:"/",component:r.a},{path:"/identify",component:o.a}],v=new s.a({routes:d});new a.a({router:v}).$mount("#app")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=i(1),n=i.n(s),r=n.a.config,c={0:"正在初始化数据...",1:"在上方画布开始绘画",2:"识别是否准确？"};e.default={data:function(){return{state:0,fontLib:n.a.fontLib,imgSrc:""}},computed:{msg:function(){return 2===this.state?"「 "+this.fontLib[0].value+" 」 "+c[this.state]:c[this.state]}},created:function(){var t=this;setTimeout(function(){n.a.initFontLib(),t.state=1},0)},mounted:function(){this.$nextTick(this.init)},methods:{init:function(){var t=this;this._canvas=new a.a(this.$refs.cvs),this._match=new a.a(this.$refs.match,4*r.grid,!1),this._canvas.callback.finish=function(e){t.state=2;var i=n.a.findMatch(e);n.a.setSize(t.$refs.img,4*r.grid),t.imgSrc=i.img,n.a.drawArea({cvs:t.$refs.match,data:e,area:{x:0,y:0,size:t.$refs.match.width},compare:i.data,style:function(t,e){return 0===t&&e>0?"rgba(255, 0, 0, "+e/2+")":0===e&&t>0?"rgba(0, 0, 0, "+t+")":0===t&&0===e?"#fff":"rgba(0, 255, 0, "+(1-Math.abs(t-e))+")"}})}},reset:function(){this.state=1,this._canvas.clear(),this.$router.push({path:"/identify"})},confirm:function(){this.state=1,this._canvas.clear(),n.a.fixFont(this.fontLib[0],.1)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),s=i.n(a),n=i(3);e.default={data:function(){return{list:s.a.fontLib,pickedItem:null}},methods:{pick:function(t){if(this.pickedItem===t)this.pickedItem=null;else{this.pickedItem=t;var e=new n.a(this.$refs.cvs,200);s.a.drawArea({cvs:e.cvs,data:s.a.userDraw.data,compare:t.data,area:{x:0,y:0,size:e.cvs.width},style:function(t,e){return 0===t&&e>0?"rgba(255, 0, 0, "+e/2+")":0===e&&t>0?"rgba(0, 0, 0, "+t+")":0===t&&0===e?"#fff":"rgba(0, 255, 0, "+(1-Math.abs(t-e))+")"}})}},confirm:function(){s.a.fixFont(this.pickedItem,.7),this.pickedItem=null,this.$router.push({path:"/"})},reset:function(){this.pickedItem=null},custom:function(){s.a.addCustomFont(window.prompt("给你画的东西起个名字吧"))}}}},,,,,,,,,,,,,,,function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"Identify"}},[i("div",{staticClass:"title"},[i("router-link",{attrs:{to:"/"}},[t._v("返回")]),t._v("选择你想画的图形")],1),t._v(" "),i("div",{staticClass:"imgs"},t._l(t.list,function(e){return i("div",{staticClass:"img-box",class:{active:e===t.pickedItem},on:{click:function(i){t.pick(e)}}},[i("img",{attrs:{src:e.img,alt:e.value}}),t._v(" "),i("i",[t._v(t._s(e.acc))])])})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.pickedItem,expression:"pickedItem"}],staticClass:"confirm"},[t._m(0),t._v(" "),i("canvas",{ref:"cvs"}),t._v(" "),i("div",{staticClass:"desc"},[i("div",[t._v("字符 "+t._s(t.pickedItem&&t.pickedItem.value))]),t._v(" "),i("div",[t._v("符合率 "+t._s(t.pickedItem&&t.pickedItem.acc))])]),t._v(" "),i("div",{staticClass:"bottom-btn-group"},[i("button",{on:{click:t.confirm}},[t._v("就他了")]),t._v(" "),i("button",{on:{click:t.reset}},[t._v("还是算了")])])]),t._v(" "),i("div",{staticClass:"btn",on:{click:t.custom}},[t._v("这里没有朕想要的")])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",{staticClass:"tips"},[i("li",[t._v("你画的区域")]),t._v(" "),i("li",[t._v("字符的区域")]),t._v(" "),i("li",[t._v("重叠的区域")])])}]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"home"}},[i("canvas",{ref:"cvs"}),t._v(" "),i("p",{attrs:{id:"msg"}},[t._v(t._s(t.msg))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],attrs:{id:"match"}},[i("canvas",{ref:"match"}),t._v(" "),i("img",{ref:"img",attrs:{src:t.imgSrc,alt:"img"}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"state === 2"}],staticClass:"bottom-btn-group"},[i("button",{on:{click:t.confirm}},[t._v("是")]),t._v(" "),i("button",{on:{click:t.reset}},[t._v("否")])])])},staticRenderFns:[]}}],[15]);
//# sourceMappingURL=app.8ea4450a2302e549c6a7.js.map