webpackJsonp([1],{11:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(10),s=a(9),r=a.n(s);i.a.config.productionTip=!1,new i.a({el:"#app",template:"<div><ocr/></div>",components:{ocr:r.a}})},12:function(t,e){var a={pen:{size:4,fillStyle:"#000",strokeStyle:"#f00"},canvas:{width:200,height:200,size:200},grid:32,like:.05,accept:.5,grayThreshold:128},i=[];e.config=a,e.fontLib=i,e.convertImageData=function(t){for(var e=[],i=0;i<t.length;i+=4)0!==t[i+3]?t[i]+t[i+1]+t[i+2]>3*a.grayThreshold?e.push(0):e.push(1):e.push(0);return e},e.detect=function(t){var e=this.convertImageData(t.data),i={};e.forEach(function(t,e){if(t){var s=Math.floor(e/a.canvas.width),r=Math.floor(e%a.canvas.width);if(void 0===i.XStart)return i.XStart=r,i.XEnd=r,i.YStart=s,void(i.YEnd=s);r<i.XStart&&(i.XStart=r),r>i.XEnd&&(i.XEnd=r),s<i.YStart&&(i.YStart=s),s>i.YEnd&&(i.YEnd=s)}});var s=i.XEnd-i.XStart,r=i.YEnd-i.YStart;return r>=s&&(i.Y=i.YStart,i.X=Math.floor(i.XStart-(r-s)/2),i.size=r),r<s&&(i.X=i.XStart,i.Y=Math.floor(i.YStart-(s-r)/2),i.size=s),i},e.adjustGrid=function(t){var e=t.size%a.grid;if(0===e)return t;var i=a.grid-e,s=Math.floor(i/2);return{X:t.X-s,Y:t.Y-s,size:t.size+i}},e.generateGridData=function(t,e){for(var i=this.convertImageData(t),s=a.grid,r=e/s,n=[],c=0;c<s;c++)for(var h=0;h<s;h++){for(var o=[],d=0;d<r;d++)for(var u=0;u<r;u++)o.push(i[h*r+c*e*r+u+d*e]);var l=o.filter(function(t){return!!t}).length/o.length;n[h+c*s]=l>a.accept?l:0}return n},e.compareArray=function(t,e){var i=0;t.forEach(function(t,s){0===t&&0===e[s]||Math.abs(t-e[s])<a.like&&i++});var s=t.filter(function(t){return t>0}).length+e.filter(function(t){return t>0}).length;return parseFloat(i/s).toFixed(4)},e.combineArray=function(t,e){var a=[];return t.forEach(function(t,i){a.push((t+e[i])/2)}),a},e.setSize=function(t,e){t.width=e,t.height=e,t.style.width=e+"px",t.style.height=e+"px"},e.clearCanvas=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},e.getGridArea=function(t){var e=t.getContext("2d");return this.adjustGrid(this.detect(e.getImageData(0,0,t.width,t.height)))},e.addFont=function(t,e){void 0===this._canvas&&(this._canvas=document.createElement("canvas"));var s=this._canvas;this.setSize(s,a.canvas.size);var r=s.getContext("2d");r.clearRect(0,0,a.canvas.size,a.canvas.size),r.font="200 "+s.height/2+"px "+e,r.textAlign="center",r.fillStyle="#000",r.fillText(t,s.width/2,s.height/2);var n=this.getGridArea(s),c=r.getImageData(n.X,n.Y,n.size,n.size),h=this.generateGridData(c.data,n.size);this.setSize(s,n.size),r.putImageData(c,0,0),i.push({value:t,data:h,img:s.toDataURL(),size:n.size})},e.fixFont=function(t,e){t.data=this.combineArray(t.data,e),this.setSize(this._canvas,t.size),this.clearCanvas(this._canvas),this.drawGridData({cvs:this._canvas,gridData:t.data,rect:{X:0,Y:0,size:t.size},fillStyle:function(t){return"rgba(0, 0, 0, "+t+")"}}),t.img=this._canvas.toDataURL()},e.drawGridData=function(t){for(var e=t.cvs,i=t.gridData,s=t.rect,r=t.fillStyle,n=t.compare,c=e.getContext("2d"),h=s.size/a.grid,o=0;o<a.grid;o++)for(var d=0;d<a.grid;d++){var u=d+o*a.grid;c.fillStyle=n?r(i[u],n[u]):r(i[u]),c.fillRect(s.X+d*h,s.Y+o*h,h,h)}}},13:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(14),s=a.n(i),r=a(12),n=a.n(r),c=n.a.config;e.default={name:"ocr",data:function(){return{drawing:!1,steps:["draw text","detect text area","adjust grid","split","compare"],step:0,detect:{},lib:n.a.fontLib,showResult:!1}},mounted:function(){for(var t=this,e=48;e<91;e++)e>57&&e<65||n.a.addFont(String.fromCharCode(e),"sans-serif");this.$nextTick(function(){s()(t.$refs.cvs,c.canvas),t.$refs.cvs.style.width=c.canvas.width+"px",t.$refs.cvs.style.height=c.canvas.height+"px",t.ctx=t.$refs.cvs.getContext("2d")})},methods:{mousemove:function(t){this.drawing&&(this.ctx.beginPath(),t.touches&&t.touches[0]&&(t.offsetX=t.touches[0].pageX,t.offsetY=t.touches[0].pageY),this.ctx.arc(t.offsetX,t.offsetY,c.pen.size,0,2*Math.PI),this.ctx.fillStyle=c.pen.fillStyle,this.ctx.fill())},drawingEnable:function(){this.drawing=!0},drawingDisable:function(){this.drawing=!1},pick:function(t){n.a.fixFont(t,this.gridData),this.reset()},preview:function(t){n.a.clearCanvas(this.$refs.cvs),this.drawUserGridData(),n.a.drawGridData({cvs:this.$refs.cvs,gridData:t.data,rect:this.detect,compare:this.gridData,fillStyle:function(t,e){return e>0?"rgba(0, 255, 0, "+(0===t?0:1-Math.abs(t-e))+")":"rgba(255, 0, 0, "+t+")"}})},drawUserGridData:function(){n.a.drawGridData({cvs:this.$refs.cvs,gridData:this.gridData,rect:this.detect,fillStyle:function(t){return"rgba(0, 0, 0, "+t+")"}})},reset:function(){this.step=0,this.showResult=!1,this.ctx.clearRect(0,0,c.canvas.width,c.canvas.height)},runStep:function(){void 0===this.autosave&&(this.autosave={}),this.step<this.steps.length-1&&(this.autosave[this.step]=this.ctx.getImageData(0,0,c.canvas.width,c.canvas.height),this["step"+String(++this.step)]())},step1:function(){var t=this.ctx.getImageData(0,0,c.canvas.width,c.canvas.height);this.detect=n.a.detect(t),this.ctx.strokeStyle=c.pen.strokeStyle,this.ctx.strokeRect(this.detect.X,this.detect.Y,this.detect.size,this.detect.size)},step2:function(){this.ctx.putImageData(this.autosave[0],0,0),this.detect=n.a.adjustGrid(this.detect),this.ctx.strokeRect(this.detect.X,this.detect.Y,this.detect.size,this.detect.size);for(var t=this.detect,e=t.X,a=t.Y,i=t.size,s=i/c.grid,r=a;r<a+i;r+=s)this.ctx.beginPath(),this.ctx.moveTo(e,r),this.ctx.lineTo(e+i,r),this.ctx.lineWidth=1,this.ctx.stroke();for(var h=e;h<e+i;h+=s)this.ctx.beginPath(),this.ctx.moveTo(h,a),this.ctx.lineTo(h,a+i),this.ctx.lineWidth=1,this.ctx.stroke()},step3:function(){this.ctx.putImageData(this.autosave[0],0,0),this.gridData=n.a.generateGridData(this.ctx.getImageData(this.detect.X,this.detect.Y,this.detect.size,this.detect.size).data,this.detect.size),n.a.clearCanvas(this.$refs.cvs),this.drawUserGridData()},step4:function(){var t=this;this.lib.forEach(function(e){e.acc=n.a.compareArray(t.gridData,e.data)}),this.lib.sort(function(t,e){return e.acc-t.acc}),this.showResult=!0,this.preview(this.lib[0])}}}},42:function(t,e){},44:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"ocr"}},[a("canvas",{ref:"cvs",on:{mousemove:t.mousemove,touchmove:t.mousemove,mousedown:t.drawingEnable,touchstart:t.drawingEnable,mouseup:t.drawingDisable,touchend:t.drawingDisable,mouseleave:t.drawingDisable}}),t._v(" "),a("div",{staticClass:"desc"},[a("h5",[t._v("STEPS")]),t._v(" "),a("ol",t._l(t.steps,function(e,i){return a("li",{class:{active:i<=t.step}},[t._v(t._s(e))])})),t._v(" "),t.showResult?a("ul",{staticClass:"result"},t._l(t.lib,function(e){return a("li",{on:{click:function(a){t.pick(e)},mouseenter:function(a){t.preview(e)}}},[a("img",{attrs:{src:e.img,alt:e.value}}),t._v(" "),a("span",[t._v(t._s(e.acc))]),t._v(" "),a("img",{staticClass:"preview",attrs:{src:e.img,alt:e.value}})])})):t._e()]),t._v(" "),this.step<this.steps.length-1?a("button",{on:{click:t.runStep}},[t._v("next step")]):t._e()])},staticRenderFns:[]}},9:function(t,e,a){a(42);var i=a(43)(a(13),a(44),null,null);t.exports=i.exports}},[11]);
//# sourceMappingURL=app.6c433207d8d214e67c72.js.map